```{r constants, include=F}

xg1 = "unguided"
xg2 = "guided"
xg3 = "waitlist"
xG1 = "Unguided"
xG2 = "Guided"
xG3 = "Waitlist"

xG3text = "Wait-list"

xpre = "pre measurement"
xdur = "during measurement"
xpost = "post measurement"
xfu = "follow-up measurement"
xPre = "Pre measurement"
xDur = "During measurement"
xPost = "Post measurement"
xFu = "Follow-up measurement"

xt1 = "pre"
xt2 = "during"
xt3 = "post"
xt4 = "followup"
xT1 = "Pre"
xT2 = "During"
xT3 = "Post"
xT4 = "Followup"

xT4text = "Follow-up"

```

```{r functions, eval = T, echo = F} 

xresult <-
  function(x, d = 2) {
    paste0("$",
           apa(
             value = x,
             decimals = d,
             leading = F
           ),
           # formatC(
           #   x,
           #   digits = d,
           #   drop0trailing = F,
           #   format = "f"
           # ),
           "$")
  }

xresulttext <-
  function(x, d = 2) {
    apa(
      value = x,
      decimals = d,
      leading = F
    )
    # formatC(x,
    #         digits = d,
    #         drop0trailing = F,
    #         format = "f")
  }

xpercent <-
  function(x, d = 2) {
    paste0("$",
           apa(
             value = x,
             decimals = d,
             leading = F
           ),
           # formatC(
           #   x,
           #   digits = d,
           #   drop0trailing = F,
           #   format = "f"
           # ),
           "$",
           "\\xspace%")
  }

xpr <- function(x, d = 3, a = NULL) {
  paste("$p_{", a, "}$",
        # ifelse(x < 0.001, "< $0.001$", ifelse(
        ifelse(x < 0.001, "< $.001$", ifelse(
          x < 0.05,
          paste0("= $",
                 apa(
                   value = x,
                   decimals = d,
                   leading = F
                 ),
                 # formatC(
                 #   x,
                 #   digits = d,
                 #   drop0trailing = F,
                 #   format = "f"
                 # ),
                 "$"),
          # ifelse(x > 0.05, "DO NOT REPORT", "= $0.05$")
          ifelse(x > 0.05, "DO NOT REPORT", "= $.05$")
        )))
}

xprnot <- function(x, d = 3, a = NULL) {
  paste("$p_{", a, "}$",
        # ifelse(x < 0.001, "< $0.001$", ifelse(
        ifelse(x < 0.001, "< $.001$", ifelse(
          x < 0.05,
          paste0(" = $",
                 apa(
                   value = x,
                   decimals = d,
                   leading = F
                 ),
                 # formatC(
                 #   x,
                 #   digits = d,
                 #   drop0trailing = F,
                 #   format = "f"
                 # ),
                 "$"),
          ifelse(x > 0.05, paste0(
            " = $",
            apa(
              value = x,
              decimals = d,
              leading = F
            ),
            # formatC(
            #   x,
            #   digits = d,
            #   drop0trailing = F,
            #   format = "f"
            # ),
            "$"
          # ), "= $0.05$")
          ), "= $.05$")
        )))
}

xps <- function(x) {
  paste(ifelse(
    x < 0.001,
    "\\textsuperscript{***}",
    ifelse(
      x < 0.01,
      "\\textsuperscript{**}",
      ifelse(x > 0.05, "", "\\textsuperscript{*}")
    )
  ))
}

xpss <- function(x) {
  paste(ifelse(
    x < 0.001,
    "\\hbox to 0bp{\\textsuperscript{***}}",
    ifelse(
      x < 0.01,
      "\\hbox to 0bp{\\textsuperscript{**}}",
      ifelse(x > 0.05, "", "\\hbox to 0bp{\\textsuperscript{*}}")
    )
  ))
}

report.anova <- function(anovaobj, row) {
  paste0(
    "$F$($",
    round(anovaobj$NumDF[row], 2),
    "$, $",
    round(anovaobj$DenDF[row], 2),
    "$",
    ") = $",
    round(anovaobj$`F value`[row], 2),
    "$, ",
    xpr(anovaobj$`Pr(>F)`[row])
  )
}

report.kw <- function(kwobj) {
  df <- length(kwobj$Z) - 1
  paste0("$\\chi^2$($",
         df,
         "$) = ",
         round(kwobj$chi2, 2),
         ", ",
         xpr(pchisq(kwobj$chi2, df, lower.tail = F)))
}

report.kwtext <-
  function(kwobj, contrast) {
    df <- length(kwobj$Z) - 1
    x <- paste0("$Z$(",
                df,
                ") = ",
                xresult(kwobj$Z[contrast], 2),
                ", ",
                xpr(kwobj$altP.adjusted[contrast]),a="Bonf")
    return(x)
  }

report.kwnot <- function(kwobj) {
  df <- length(kwobj$Z) - 1
  paste0(xprnot(pchisq(kwobj$chi2, df, lower.tail = F)))
}

# Would it be better to build custom contrasts with fewer comparisons?
# (Yes, that would be better, but we are still protected from p-hacking by Bonferroni correction)
# https://aosmith.rbind.io/2019/04/15/custom-contrasts-emmeans/#reasons-for-custom-comparisons

rout <- function(lmerobj) {
  x.emmeans <- emmeans(lmerobj, ~ c(time,group))
  excluderows <- -c(3, 13, 22, 31:38)
  x.emmpairs <-
    pairs(
      x.emmeans,
      adjust = "bonferroni"
    )[excluderows]
  x.sd <-
    sqrt(as.data.frame(VarCorr(lmerobj))[1, 4] + as.data.frame(VarCorr(lmerobj))[2, 4])
  x.effectsizes <-
    eff_size(x.emmeans[effsel.group], sigma = x.sd, edf = df.residual(lmerobj))
  return(
    list(
      emmeans = as.data.frame(x.emmeans),
      emmpairs = as.data.frame(x.emmpairs),
      sd = x.sd,
      effectsizes = as.data.frame(x.effectsizes)
    )
  )
}

effsize.tabrow2 <- function(outobj, contrast, direction, stars = "stars") {
  effrow <- which(outobj$effectsizes$contrast == contrast)
  stars <-  if( stars == "nostars" ) {} else {
      stars <-
    xpss(outobj$emmpairs$p.value[effrow])
  }
  if (direction == -1) {
    lower = outobj$effectsizes$upper.CL[effrow] * direction
    upper = outobj$effectsizes$lower.CL[effrow] * direction
  } else {
    lower = outobj$effectsizes$lower.CL[effrow] * direction
    upper = outobj$effectsizes$upper.CL[effrow] * direction
  }
  paste0(
    "\\parbox[b]{4.25em}{\\flushright",
    xresult(outobj$effectsizes$effect.size[effrow] * direction, 2),
    "}",
    "~[",
    xresult(lower, 2),
    ", ",
    xresult(upper, 2),
    "]",
    stars
  )
}

report.text <-
  function(outobj, effrow, direction = 1, emmpairsrow) {
    if (direction == -1) {
      lower = outobj$effectsizes$upper.CL[effrow] * direction
      upper = outobj$effectsizes$lower.CL[effrow] * direction
    } else {
      lower = outobj$effectsizes$lower.CL[effrow] * direction
      upper = outobj$effectsizes$upper.CL[effrow] * direction
    }
    paste0(
      "$\\Delta M$ = ",
      xresult(outobj$emmpairs$estimate[emmpairsrow] * direction, 1),
      # ", $t$\\(_{",
      ", $t$($",
      xresulttext(outobj$emmpairs$df[emmpairsrow], 0),
      #"}\\) = ",
      "$) = ",
      xresult(outobj$emmpairs$t.ratio[emmpairsrow], 2),
      ", ",
      xpr(outobj$emmpairs$p.value[emmpairsrow],a="Bonf"),
      ", $ES$ = ",
      xresult(outobj$effectsizes$effect.size[effrow] * direction, 2),
      ", 95\\% CI [",
      xresult(lower, 2),
      ", ",
      xresult(upper, 2),
      "]"
    )
    return(x)
  }

report.text2 <-
  function(outobj, contrast, direction = 1, stats = "allshort") {
    effrow <- which(outobj$effectsizes$contrast == contrast)
    if (direction == -1) {
      lower = outobj$effectsizes$upper.CL[effrow] * direction
      upper = outobj$effectsizes$lower.CL[effrow] * direction
    } else {
      lower = outobj$effectsizes$lower.CL[effrow] * direction
      upper = outobj$effectsizes$upper.CL[effrow] * direction
    }
    x.delta <- paste0(
      "$\\Delta M$ = ",
      xresult(outobj$emmpairs$estimate[effrow] * direction, 1)
    )
    x.sig <- paste0(
      "$t$($",
      xresulttext(outobj$emmpairs$df[effrow], 0),
      "$) = ",
      xresult(outobj$emmpairs$t.ratio[effrow], 2),
      ", ",
      xpr(outobj$emmpairs$p.value[effrow],a="Bonf")
    )
    x.sigshort <-
      xpr(outobj$emmpairs$p.value[effrow],a="Bonf")
    x.eff <- paste0(
      "$ES$ = ",
      xresult(outobj$effectsizes$effect.size[effrow] * direction, 2),
      ", 95\\% CI [",
      xresult(lower, 2),
      ", ",
      xresult(upper, 2),
      "]"
    )
    x.effshort <- paste0(
      "$ES$ = ",
      xresult(outobj$effectsizes$effect.size[effrow] * direction, 2)
    )
    output <- if (stats == "sigshort") {
      x.sigshort
    } else if (stats == "sig") {
      x.sig
    } else if (stats == "delta") {
      x.delta
    } else if (stats == "effshort") {
      x.effshort
    } else if (stats == "eff") {
      x.eff
    } else if (stats == "sigeffshort") {
      paste0(x.sigshort,", ",x.effshort)
    } else if (stats == "allshort") {
      paste0(x.delta, ", ", x.sig, ", ", x.effshort)
    } else if (stats == "all") {
      paste0(x.delta, ", ", x.sig, ", ", x.eff)
    }
    return(output)
  }

effsize.tabrow <- function(outobj, contrast, direction) {
  effrow <-
    which(rout(aaas_ad.lmer)$effectsizes$contrast == contrast)
  stopifnot(all(outobj$emmpairs[-c(3, 13, 22, 31:38), ][, 1] == outobj$effectsizes[, 1]))
  stars <-
    xpss(outobj$emmpairs[-c(3, 13, 22, 31:38), ]$p.value[effrow])
  if (direction == -1) {
    lower = outobj$effectsizes$upper.CL[effrow] * direction
    upper = outobj$effectsizes$lower.CL[effrow] * direction
  } else {
    lower = outobj$effectsizes$lower.CL[effrow] * direction
    upper = outobj$effectsizes$upper.CL[effrow] * direction
  }
  linebreak(paste0(
    xresult(outobj$effectsizes$effect.size[effrow] * direction, 2),
    " [",
    xresult(lower, 2),
    ", ",
    xresult(upper, 2),
    "]",
    stars
  ),
  align = "c")
}

```

# Introduction

<!-- 2do: add a line to discussion about sex diffs in acquisition/extinction of avoidance behaviors, ref Sheynin2014. -->

Escape and avoidance is associated with the development of maladaptive behavior among vulnerable participants in laboratory trials [@Sheynin2014], as well as psychopathologies in clinical presentations. Experiences of stress, anxiety, and depression are often associated with avoidance of constructively presenting one’s thoughts, feelings, needs, and wishes in relation to others, that is deficits in assertive behavior [@Speed2018a]. Assertiveness can be difficult to delineate from social skills in general [@LINEHAN1979], but a common definition is “direct, firm, positive [...] action [enabling] us to act in our own best interests, to stand up for ourselves without undue anxiety, to exercise personal rights without denying the rights of others, and to express our feelings and needs [...] honestly and comfortably” [@alberti2017your,p.34]. Examples include politely saying "no" to a boss requesting undue overtime, actively participating in social activities, accepting/acknowledging a compliment without deflecting, and verbalizing feelings in personal relationships without acting out. A lack of assertiveness is associated with several psychological problems, including stress, generalized anxiety, social anxiety, depression, and panic disorder, as well as emotional instability, strained relationships, and low self-esteem [@Speed2018a]. While there are diagnoses, diagnostic tools, and treatment manuals for conditions associated with these problems, no evidence-based interventions specifically target assertiveness for a broader population.

Assertiveness training dates back to the very first behavioral therapies [e.g., @salter1949conditioned; @Wolpe1966]. In the 1970s, the concept was popularized in self-help books [e.g., @alberti1974your; @smith1975say; @fensterheim1975don]. Research on assertiveness training peaked in the 1980s [@Speed2018a]. Although the behavioral techniques of the first wave of therapy were supplemented by cognitive restructuring techniques [e.g., @beck1979cognitive], in the following decades, techniques such as modeling and behavior rehearsal remained active parts of treatments for psychological syndromes such as anxiety disorders and depression. Linehan's [-@LINEHAN1979] manual for assertion therapy combining behavior rehearsal with cognitive restructuring was a stepping stone toward Dialectical Behavior Therapy (DBT), in which assertion skills training in a group setting is integral [@linehan1993skills].

Assertion is regarded as a situation-specific trait rather than a generalized trait [@Hull1978]. Building on the definition by @alberti2017your, assertiveness can be operationalized as acting with respect to personal rights without infringing on the rights of others. Constructive assertion takes into account both the desired result of the interaction (e.g., saying "no" to someone else’s demand or making a request) and the intensity of the interaction, where the latter is calibrated with regard to both the importance of the relationship and what @linehan1993skills refers to as self-respect. Using this definition, assertive behavior can be thought of as the product of respect for the rights of others and respect for one’s own rights. This definition offers several opportunities for idiographic and contextual descriptions of assertion in therapy (i.e., when designing in vivo behavioral experiments, regardless of cultural influences on what is considered acceptable behavior within a family, community, society, etc.) [@Sigler2008;@Mitamura2018].

@Speed2018a concluded that while assertiveness training is part of DBT, as well as acceptance and commitment therapy (ACT), general assertiveness training is not often mentioned in the current CBT literature. Few studies on assertiveness training have been published since the early 1980s. Recent exceptions include @Baker2015, showing a negative relationship between social anxiety and assertiveness. @Vagos2019 reported a negative association between mental distress in general and assertiveness, and @Antunez2020 found a link between circadian typology and level of assertiveness. @Speed2018a further concluded that there is potential for assertiveness training as an intervention for individuals suffering from anxiety and depression, and as a means to increase relationship satisfaction. The lack of contemporary evidence for the assertiveness construct and assertiveness training as a transdiagnostic intervention calls for new research on the subject. 

While the empirical support for assertiveness training is scarce at best, there is much evidence for the effectiveness of CBT for symptoms and syndromes associated with inadequate assertiveness. In a review of meta-analyses, Hofmann et al. (2012) conclude that CBT is one of the most effective forms of therapy. This includes its application for symptoms related to trauma and stress, as well as syndromes related to depression and anxiety. A review by @Andrews2018 also lends support to internet-delivered CBT (iCBT) for anxiety and depression, showing an average between-group effect size of $g$ = `r xresult(0.8,2)` compared to the controls. @Carlbring2018 also show that iCBT, on average, produces equivalent overall effects compared to face-to-face treatment. iCBT has proven effective in both guided and unguided applications (i.e., with or without therapist support), although guided iCBT tends to produce slightly larger effects [@Baumeister2014a]. iCBT has also proven effective in transdiagnostic applications, including interventions targeting stress [@Day2013], procrastination [@Rozental2015], and perfectionism [@Rozental2017]. The Western Australian Centre for Clinical Interventions offers various self-help resources for mental health problems. These resources include Assert Yourself [@michel2008], a series of 10 modules with concepts and strategies primarily based on cognitive behavioral therapy (CBT), with a focus on assertiveness.

This study aimed to conduct a randomized controlled trial (RCT) on the effects of an eight-week iCBT intervention targeting unhealty assertiveness, Respekt^2^ (Respect Squared), based on the @michel2008 modules. We tested the effects on measures of anxiety, depression, and well-being, as well as the difference between guided and unguided iCBT against the control group (three-armed trial).  

<!-- The research questions are as follows: -->

<!-- - What are the effects on assertiveness of guided and unguided participation in Respekt^2^ compared to a wait-list control group? -->

<!-- - What are the effects of guided and unguided participation on measures of anxiety and depression compared to the control group? -->

```{r prepare.data, echo = F, eval = F}

## Export settings

# - 2020-01-27 "Respekt i kvadrat - förmätning" PRE Groups 1+2+3
# - 2020-03-09 "Respekt i kvadrat - mittmätning utan Corona" DUR Groups 1+2+3
# - 2020-04-06 "Respekt i kvadrat - eftermätning" POST Groups 1+2
# - 2020-04-06 "Respekt i kvadrat - eftermätning väntelista" POST Group 3
# - 2021-04-21 "Respekt i kvadrat - 1-årsuppföljning" FU Groups 1+2

# Export settings recorded in "Screenshot 2021-12-12 at 11-29-37 Exportera.png"

raw_excel = "Respekt_surveys_211213_101425.xlsx"
r2fu.raw.data <- read_excel(raw_excel)

# Remove cases that meet exclusion criteria but were erroneously included in the study
r2fu.raw.data <- r2fu.raw.data[-c(13,48,52,97,158),]

# Missing data as NA values
r2fu.raw.data[r2fu.raw.data == "[missing data]" ] <- NA

# As dataframe
r2fu.raw.data <- as.data.frame(r2fu.raw.data)

# Unite POST measurements for Groups 1 + 2 with those for Group 3
cols.count <- 21
g3key <- which(!is.na(r2fu.raw.data[3 * cols.count + 8]))
r2fu.raw.data[g3key, c(1:cols.count) + 2 * cols.count] <-
  r2fu.raw.data[g3key, c(1:cols.count) + 3 * cols.count]

# Create vector with group designations
r2fu.groups <-
  factor(ifelse(
    grepl("Grupp 1", r2fu.raw.data[,3]),
    1,
    ifelse(
      grepl("Grupp 2", r2fu.raw.data[,3]),
      2,
      ifelse(grepl("Grupp 3", r2fu.raw.data[,3]), 3, NA)
    )
  ),
  levels = c(3,1,2),
  labels = c(xg3,xg1,xg2))

# Only keep relevant columns
r2fu.raw.data <-
  r2fu.raw.data[, c(
    c(9:cols.count) + 0 * cols.count,
    c(9:cols.count) + 1 * cols.count,
    c(9:cols.count) + 2 * cols.count,
    c(9:cols.count) + 4 * cols.count
  )]

# Set colnames
timepoint.names <- c(1,2,3,4)
scale.names <- c(
  "rathus",
  "aaas_ag",
  "aaas_ad",
  "lsas_anx",
  "lsas_avo",
  "lsas_int",
  "lsas_per",
  "lsas_sum",
  "gad_sum",
  "phq_sum",
  "phq_sui",
  "phq_q10",
  "well"
)
colnames(r2fu.raw.data) <- paste(scale.names,rep(timepoint.names,each=length(scale.names)),sep=".")

# Add anonymous subject IDs
r2fu.raw.data$subject <- factor(c(1:length(r2fu.raw.data[,1]))) 

# Add in group designations
r2fu.raw.data$group <- r2fu.groups 

# Make sure numericals are numeric
r2fu.raw.data[, c(1:52)] <-
  sapply(r2fu.raw.data[, c(1:52)], as.numeric)

# Save anonymised data in wide format
saveRDS(r2fu.raw.data,file="r2fu.raw.data.RDS")

# Pivot to long format
r2fu.long.data <- r2fu.raw.data %>%
  pivot_longer(c(1:52),
               names_to = c(".value", "time"),
               names_pattern = "(.*).(\\d+)") %>% as.data.frame()
r2fu.long.data$time <- as.factor(r2fu.long.data$time)
saveRDS(r2fu.long.data,file="r2fu.long.data.RDS")
write_xlsx(r2fu.long.data, "r2fu.long.data.xlsx")

# Pivot back to wide format (should be equivalent to raw data)
r2fu.wide.data <- r2fu.long.data %>%
  pivot_wider(names_from = time,
              names_sep = ".",
              values_from = scale.names) %>% as.data.frame()
saveRDS(r2fu.wide.data,file="r2fu.wide.data.RDS")
write_xlsx(r2fu.wide.data, "r2fu.wide.data.xlsx")

```

```{r import.data, echo = F, eval = T}

r2fu.wide.data <- readRDS("r2fu.wide.data.RDS")
r2fu.long.data <- readRDS("r2fu.long.data.RDS")

# Update factor labels to use initial Uppercase character
r2fu.long.data$time <- factor(r2fu.long.data$time, labels = c(xT1,xT2,xT3,xT4))
r2fu.long.data$group <- factor(r2fu.long.data$group, labels = c(xG3,xG1,xG2))

```

# Method

## Design

```{r powercalc, echo = F, eval = F}

round(pwr.f2.test(
  u = 3,
  v = NULL, # Solve for sample size
  f2 = 0.8,
  power = 0.9,
  sig.level = 0.05
)$v / 0.85 ^ 8,
digits = -1) * 3

```

We randomly allocated participants to three groups: (1) guided self-help, (2) unguided self-help, and (3) eight-week wait-list control. The final sample consisted of 210 participants, with 70 participants per group. The group sizes were based on an a priori power calculation according to guidelines for linear models outlined in @cohen1988statistical, assuming a between-group effect size of Cohen’s $d$ of `r xresult(0.8,2)` on the Adaptive and Aggressive Assertiveness Scales [AAA-S\; @Thompson2011], power `r xresult(0.9,2)`, alpha `r xresult(0.05,2)`, and a $15$\% "worst case" drop-out rate per week, with the duration of the intervention being eight weeks in total.

The study was registered at ClinicalTrials.gov (NCT04240249). An error in the design was corrected post-registration, in that the Rathus Assertiveness Schedule (RAS) scale was moved from the secondary outcome measures category to the primary outcome measures category, as the scale captures the primary dependent variable of interest. Before recruitment started, the study received ethical approval from the Swedish Ethical Review Authority (Diary number: 2019-05165). 

## Participants

Participants were recruited from the public through advertisements on social media and other websites. Interested individuals were referred to a purpose-built secure website [@Vlaescu2016] with more information on the study, including the participation criteria. The participants were required to be Swedish citizens, at least 18 years of age, have access to the internet, and be fluent in Swedish. Information on the website also included the risks associated with participation, as well as the terms and conditions for participation. Volunteers were invited to submit their email addresses, and those who did were sent a link to complete an online screening questionnaire. The questionnaire included self-report measures of anxiety, depression, general well-being, and assertiveness, as well as questions regarding socio-demographics, experiences of psychological treatment, any current medication, and motivation for participation. See Table 1 for a summary of the socio-demographic baseline characteristics.

\begin{table}

\caption{\label{tab:demdata}Socio-demographic baseline characteristics of participants.}
\centering
\begin{tabular}[t]{>{\raggedright\arraybackslash}p{10em}>{\centering\arraybackslash}p{4em}>{\centering\arraybackslash}p{4em}>{\centering\arraybackslash}p{4em}>{\centering\arraybackslash}p{4em}}
\toprule
  & Wait-list & Unguided & Guided & Total\\
  & $n$ = 68 & $n$ = 67 & $n$ = 70 & $n$ = 205\\
\midrule
\addlinespace[0.3em]
\multicolumn{5}{l}{Age (years)}\\
\hspace{1em}$M$ ($SD$) & 41 (8) & 41 (9) & 44 (10) & 42 (9)\\
\midrule
\addlinespace[0.3em]
\multicolumn{5}{l}{Sex (\%)}\\
\hspace{1em}Female & 91 & 79 & 93 & 88\\
\midrule
\addlinespace[0.3em]
\multicolumn{5}{l}{Civil status (\%)}\\
\hspace{1em}Single & 37 & 36 & 29 & 34\\
\hspace{1em}Partner & 19 & 25 & 17 & 20\\
\hspace{1em}Married & 37 & 28 & 49 & 38\\
\hspace{1em}Other & 7 & 10 & 6 & 8\\
\midrule
\addlinespace[0.3em]
\multicolumn{5}{l}{Highest educational level (\%)}\\
\hspace{1em}Other & 3 & 1 & 1 & 2\\
\hspace{1em}Middle school & 1 & 0 & 0 & 0\\
\hspace{1em}High school/college & 10 & 9 & 7 & 9\\
\hspace{1em}Vocational training & 7 & 4 & 7 & 6\\
\hspace{1em}Currently at university & 7 & 15 & 10 & 11\\
\hspace{1em}University degree & 71 & 70 & 74 & 72\\
\midrule
\addlinespace[0.3em]
\multicolumn{5}{l}{Occupation (\%)}\\
\hspace{1em}Other & 9 & 6 & 7 & 7\\
\hspace{1em}Student & 7 & 12 & 6 & 8\\
\hspace{1em}Employed & 74 & 76 & 76 & 75\\
\hspace{1em}Unemployed & 4 & 4 & 0 & 3\\
\hspace{1em}Retired & 0 & 0 & 4 & 1\\
\hspace{1em}Parental leave & 0 & 0 & 4 & 1\\
\hspace{1em}Sick leave & 6 & 1 & 3 & 3\\
\midrule
\addlinespace[0.3em]
\multicolumn{5}{l}{Use of psychotropic medications (\%)}\\
\hspace{1em}No & 76 & 70 & 67 & 71\\
\hspace{1em}Yes, previously & 7 & 9 & 17 & 11\\
\hspace{1em}Yes, currently & 16 & 21 & 16 & 18\\
\midrule
\addlinespace[0.3em]
\multicolumn{5}{l}{Previous psychological treatment (\%)}\\
\hspace{1em}No & 38 & 40 & 39 & 39\\
\hspace{1em}Yes & 62 & 60 & 61 & 61\\
\bottomrule
\end{tabular}
\end{table}

In total, 657 individuals submitted their email addresses, of whom 464 completed the screening questionnaire. Of these, 126 were excluded for meeting the exclusion criteria, which were concurrent psychological treatment, a recent change in psychotropic medication, lack of time and/or motivation for participation, and a rating of 15 or above on the Patient Health Questionnaire (PHQ-9) measure of depression. The remaining 338 individuals were invited to participate in the study. Of these, 253 accepted the invitation.

## Procedure

Following the a priori power calculation, 210 participants were randomized to be included in the study. The remaining 43 individuals were offered access to the treatment materials but were excluded from all the analyses. The 210 participants were randomized to the three treatment conditions. The participants in the guided condition were randomized to one of two therapists. See Figure 1 for a flow-chart detailing the recruitment and randomization steps. All randomization was performed by an independent third party at Stockholm University using random.org [@RandomOrg] and sealedenvelope.com [@sealed].

## Measures

The data were collected using the measures described below at four time points: week 0 (pre-treatment), week 4 (during the intervention), week 8 (post-treatment), and at a one-year follow-up. Participants in the wait-list condition were not administered the follow-up measurement since they were given access to the unguided branch of the intervention after the post-treatment time point. 

### Primary measures

Assertiveness style was measured using a Swedish translation (contributed by TH) of the Adaptive and Aggressive Assertiveness Scales [AAA-S\; @Thompson2011], which contains 30 items, including “When someone I don’t know well borrows something from me and forgets to return it, I… a. Demand it back; b. Ask if she/he is done and ask for it back” (a. and b. both scored from 1 = never to 5 = always). The English-language version of the AAA-S have good internal consistency for aggressive assertiveness (`r xresult(0.88,2)`), and excellent for adaptive assertiveness  (`r xresult(0.93,2)`), respectively. A Swedish translation (contributed by TH) of the Rathus Assertiveness Schedule [RAS\; @Rathus1973] was used as an additional measure of assertiveness style with 30 items, including “I find it embarrassing to return merchandise” (+3 = very characteristic of me, extremely descriptive to --3 = very uncharacteristic of me, extremely nondescriptive). The RAS has good internal consistency (`r xresult(0.87,2)`) [@Thompson2011].

### Secondary measures

Depression was measured using the Patient Health Questionnaire 9-Item Scale [PHQ-9\; @Kroenke2010], which contains nine items, including “Feeling down, depressed, or hopeless” (0 = not at all to 3 = nearly every day). Generalized anxiety was measured using the Generalized Anxiety Disorder 7-item Scale [GAD-7\; @Kroenke2006], which contains seven items, including “Feeling nervous, anxious, or on edge” (0 = not at all to 3 = nearly every day). Social anxiety was measured using the Liebowitz Social Anxiety Scale [LSAS-SR\; @Fresco2001], which contains 24 items, including “Calling someone you don’t know very well” (fear or anxiety, 0 = none to 3 = severe; avoidance, 0 = never to 3 = usually). General well-being was measured using the Questionnaire on well-being [@Braconier2015], which contains 18 items, such as "To what extent during the past week have you felt calm and relaxed?" (0 = never to 5 = very often). These self-report measures have reported either good or excellent internal consistency (`r xresult(0.89,2)`, `r xresult(0.92,2)`, `r xresult(0.96,2)`, and `r xresult(0.926,2)`, respectively).

## Intervention

The intervention was based on the Assert Yourself modules by @michel2008, which were adapted to Swedish by TH with permission from the copyright holders. The self-help material teaches the distinction between different types of assertiveness (constructive, aggressive, passive, and passive-aggressive). It also aids the reader in finding reasons to act more assertively and constructively. The material is inspired by and cites works by @alberti1974your, @gambrill1975assertion, and @smith1975say, among others. In the material, assertiveness is described and operationalized based on Wolpe's [-@wolpe1990practice] theoretical assumptions regarding reciprocal inhibition and classic conditioning: By assertively practicing the expression of feelings, wishes, and demands in anxiety-evoking situations and relationships, where the person was previously prone to non-assertive behavior (e.g., subdued disappointment or anger), a person may experience less discomfort from autonomous anxiety responses over time. This is to be practiced in vivo, not just by acting. The long-term goal is to learn how to inhibit anxiety by being assertive. In cases where a physical counterpart is absent and anxiety is invoked by places, objects, or words, @Wolpe1952 suggests relaxation as a means to inhibit the anxiety response.

The material also includes a rationale for cognitive restructuring with methods by @beck1979cognitive, @Clark1986, @clark1995cognitive, and @powell2017mental. Through behavioral experiments, readers test the validity of negative thoughts to achieve greater flexibility in their responses. Furthermore, the material includes a passage on progressive muscle relaxation for the reader to recognize bodily tension, reduce general strain, and practice an active coping technique for stressful situations. Chapters on specific challenges, such as saying "no," dealing with criticism, and coping with disappointment, conclude the material.

The Swedish adaptation prompted additions to @michel2008, some of which are presented here. Based on recent research on exposure and inhibitory learning [e.g., @Craske2008], the participants were encouraged to actively vary learning situations and work on new skills in as many environments as possible. In another new passage, inspired by the works on acceptance by Hayes [e.g., -@Hayes2004a] and others, the participants were encouraged to actively search for and remain in the respondent discomfort they previously avoided. In line with Öst’s [-@ost2006tillampad] recommendations for applied tension, progressive muscle relaxation was introduced early in the intervention and expanded over several weeks. The written material was also complemented by downloadable audio relaxation exercises, videos of conversations and role-playing, and several new interactive exercises.

Additional support for participants in the guided self-help condition included weekly messages on the treatment platform, involving feedback on homework, encouragement, validation, psychoeducation, and answers to any questions. The therapists were allocated 15 minutes of work per participant per week.

### Therapists

Both therapists working with participants in the guided condition were final-year clinical psychology students at Stockholm University. Both had completed basic training in CBT and received continuous supervision from a licensed psychotherapist with more than two decades of iCBT experience.

## Data preparation

Five participants were excluded from the analyses due to wrongful inclusion, as they were receiving concurrent psychological treatment.

```{r flowchart-dot, engine = "dot", fig.cap = "A total of 210 participants were included in the study through randomization and further randomized into three groups: unguided self-help, guided self-help, and wait-list, with 70 participants each.",results = "as.is"}
digraph G {

  dpi=600
  fontname=Helvetica
  fontsize=10
  node [ shape=box, fontname=Helvetica, fontsize=10, penwidth=0.5 ]
  compound=true
  #ranksep=.275
  ranksep=.3
  
  leads -> { screening_non_completers screening_completers }
  screening_completers -> { excluded invited }
  invited  -> { invitation_non_responders invitation_responders }
  invitation_responders -> { trimmed keepers }
  keepers -> randomization
  randomization -> selfhelp_dur [lhead=cluster_selfhelp]
  randomization -> support_dur [lhead=cluster_support]
  randomization -> waitlist_dur [lhead=cluster_waitlist]

  leads[label=<Leads from social media<BR/><I>n</I> = 657>]
  screening_completers[label=<Completed screening<BR/><I>n</I> = 464>]
  excluded[label=<Excluded from study<BR/><I>n</I> = 126, for the following reasons:<BR/>PHQ-9 cutoff (≥ 15), <I>n</I> = 77<BR/>Concurrent therapy, <I>n</I> = 29<BR/>Recent change in psychotropic drugs, <I>n</I> = 7<BR/>Low motivation/lack of time, <I>n</I> = 13>]
  screening_non_completers[label=<Did not complete screening<BR/><I>n</I> = 193>]
  invited[label=<Invited to participate in study<BR/><I>n</I> = 338>]
  invitation_non_responders[label=<Declined or did not respond<BR/><I>n</I> = 85>]
  invitation_responders[label=<Accepted invitation<BR/><I>n</I> = 253>]
  trimmed[label=<Excluded through randomization<BR/><I>n</I> = 43>]
  keepers[label=<Included through randomization<BR/><I>n</I> = 210>]
  randomization[label=<Randomization to condition<BR/><I>n</I> = 70 each>]
  selfhelp_dur[label=<Completed During measurement<BR/>(week 4)<BR/><I>n</I> = 44>]
  selfhelp_post[label=<Completed Post measurement<BR/>(week 8)<BR/><I>n</I> = 35>]
  selfhelp_fu[label=<Completed Follow-up measurement<BR/>(1 year)<BR/><I>n</I> = 30>]
  support_dur[label=<Completed During measurement<BR/>(week 4)<BR/><I>n</I> = 48>]
  support_post[label=<Completed Post measurement<BR/>(week 8)<BR/><I>n</I> = 50>]
  support_fu[label=<Completed Follow-up measurement<BR/>(1 year)<BR/><I>n</I> = 38>]
  waitlist_dur[label=<Completed During measurement<BR/>(week 4)<BR/><I>n</I> = 58>]
  waitlist_post[label=<Completed Post measurement<BR/>(week 8)<BR/><I>n</I> = 61>]
  itt[label=<Intention to treat<BR/><I>n</I> = 205>]

  subgraph cluster_selfhelp { margin=8; penwidth=0.5; labelloc="t"; color=black; bgcolor=white; label=<Unguided self-help<BR/><I>n</I> = 70 – 3 (excluded) = 67> ; selfhelp_dur -> selfhelp_post -> selfhelp_fu; } 
  subgraph cluster_support { margin=8; penwidth=0.5; labelloc="t"; color=black; bgcolor=white; label=<Guided self-help<BR/><I>n</I> = 70> ; support_dur -> support_post -> support_fu; } 
  subgraph cluster_waitlist { margin=8; penwidth=0.5; labelloc="t"; color=black; bgcolor=white; label=<Wait-list<BR/><I>n</I> = 70 – 2 (excluded) = 68> ; waitlist_dur -> waitlist_post; } 
  { selfhelp_fu support_fu waitlist_post } -> itt

}
```

## Analysis

All the data were analyzed using `r R.Version()$language` `r paste(R.Version()[c("major", "minor")], collapse = ".")`, with the packages lmerTest [@R-lmerTest], emmeans [@R-emmeans], ggeffects [@R-ggeffects], performance [@R-performance], and clinicalsignificance [@R-clinicalsignificance]. All the syntax is available at https://github.com/hmep/r2fu/, together with the anonymized data. 

A linear mixed-effects model was fitted to estimate the fixed effects of group, time, and group-time interaction, and the random effects of participant (specifying a random intercept to control for individual differences), using an unstructured covariance pattern and the Restricted maximum likelihood (REML) estimation method. The Kenward-Roger approximations were used to estimate denominator degrees of freedom. Post-hoc pairwise comparisons of estimated marginal means were performed using T-tests. The significance of all the post-hoc tests was decided with Bonferroni-corrected p-values. The proportions of participants showing reliable change and reaching clinical significance were determined following @Jacobson1991, using the “c” definition to select the cutoff value. To honor the intention-to-treat principle in the analysis of clinical significance, the last observation was carried forward for any missing values.

```{r mixedmodels, fig.width = 13, fig.asp = 0.75, echo = F, eval = T, results='hide'}

lnT4 <-!grepl(xT4, r2fu.long.data$time) # Exclude the Follow-up time point

### Primary measures

aaas_ad.post.lmer <-
  lmerTest::lmer(
    aaas_ad ~ group * time + (1 | subject),
    data = r2fu.long.data[lnT4,],
    na.action = na.omit,
    REML = T
  )
# performance::check_model(aaas_ad.lmer) # Checked, found to be OK!
aaas_ad.post.anova <- anova(aaas_ad.post.lmer, type=3, ddf="Kenward-Roger") # Significant interaction time x group
aaas_ad.lmer <-
  lmerTest::lmer(
    aaas_ad ~ group * time + (1 | subject),
    data = r2fu.long.data,
    na.action = na.omit,
    REML = T
  )
# performance::check_model(aaas_ad.lmer) # Checked, found to be OK!
aaas_ad.anova <- anova(aaas_ad.lmer, type=3, ddf="Kenward-Roger")
aaas_ad.emm.plot <-
  plot(
    ggemmeans(aaas_ad.lmer, terms = c("time", "group")),
    show.title = F,
    show.x.title = F,
    colors = "bw",
    connect.lines = T,
    line.size = .4,
    dot.size = 3
  ) + scale_shape_manual(values=c(1, 17, 15), name = "Group", labels = c(`xG3text`, xG1, xG2)) + scale_x_continuous(labels=c(xT1, xT2, xT3, `xT4text`))
aaas_ad.emm.plot <- aaas_ad.emm.plot +
  labs(y = "AAA-S, Adaptive subscale") + theme_apa(legend.pos = "topleft", legend.font.size = 12, y.font.size = 10)

aaas_ag.post.lmer <-
  lmerTest::lmer(
    aaas_ag ~ group * time + (1 | subject),
    data = r2fu.long.data[lnT4,],
    na.action = na.omit,
    REML = T
  )
# performance::check_model(aaas_ag.lmer) # Checked, found to be OK!
aaas_ag.post.anova <- anova(aaas_ag.post.lmer, type=3, ddf="Kenward-Roger") # Significant interaction time x group
aaas_ag.lmer <-
  lmerTest::lmer(
    aaas_ag ~ group * time + (1 | subject),
    data = r2fu.long.data,
    na.action = na.omit,
    REML = T
  )
# performance::check_model(aaas_ag.lmer) # Checked, found to be OK!
aaas_ag.anova <- anova(aaas_ag.lmer, type=3, ddf="Kenward-Roger")
aaas_ag.emm.plot <-
  plot(
    ggemmeans(aaas_ag.lmer, terms = c("time", "group")),
    show.title = F,
    show.x.title = F,
    colors = "bw",
    connect.lines = T,
    line.size = .4,
    dot.size = 3
  ) + scale_shape_manual(values=c(1, 17, 15), name = "Group", labels = c(`xG3text`, xG1, xG2)) + scale_x_continuous(labels=c(xT1, xT2, xT3, `xT4text`))
aaas_ag.emm.plot <- aaas_ag.emm.plot + 
  labs(y = "AAA-S, Aggressive subscale") + theme_apa(legend.pos = "topleft", legend.font.size = 12, y.font.size = 10)

rathus.post.lmer <-
  lmerTest::lmer(
    rathus ~ group * time + (1 | subject),
    data = r2fu.long.data[lnT4,],
    na.action = na.omit,
    REML = T
  )
# performance::check_model(rathus.lmer) # Checked, found to be OK!
rathus.post.anova <- anova(rathus.post.lmer, type=3, ddf="Kenward-Roger") # Significant interaction time x group
rathus.lmer <-
  lmerTest::lmer(
    rathus ~ group * time + (1 | subject),
    data = r2fu.long.data,
    na.action = na.omit,
    REML = T
  )
# performance::check_model(rathus.lmer) # Checked, found to be OK!
rathus.anova <- anova(rathus.lmer, type=3, ddf="Kenward-Roger")
rathus.emm.plot <-
  plot(
    ggemmeans(rathus.lmer, terms = c("time", "group")),
    show.title = F,
    show.x.title = F,
    colors = "bw",
    connect.lines = T,
    line.size = .4,
    dot.size = 3
  ) + scale_shape_manual(values=c(1, 17, 15), name = "Group", labels = c(`xG3text`, xG1, xG2)) + scale_x_continuous(labels=c(xT1, xT2, xT3, `xT4text`))
rathus.emm.plot <- rathus.emm.plot +
  labs(y = "Rathus Assertiveness Schedule (RAS)") + theme_apa(legend.pos = "topleft", legend.font.size = 12, y.font.size = 10) 

### Secondary measures

lsas_sum.post.lmer <-
  lmerTest::lmer(
    lsas_sum ~ group * time + (1 | subject),
    data = r2fu.long.data[lnT4,],
    na.action = na.omit,
    REML = T
  )
# performance::check_model(lsas_sum.lmer) # Checked, found to be OK!
lsas_sum.post.anova <- anova(lsas_sum.post.lmer, type=3, ddf="Kenward-Roger") # Significant interaction time x group
lsas_sum.lmer <-
  lmerTest::lmer(
    lsas_sum ~ group * time + (1 | subject),
    data = r2fu.long.data,
    na.action = na.omit,
    REML = T
  )
# performance::check_model(lsas_sum.lmer) # Checked, found to be OK!
lsas_sum.anova <- anova(lsas_sum.lmer, type=3, ddf="Kenward-Roger")
lsas_sum.emm.plot <-
  plot(
    ggemmeans(lsas_sum.lmer, terms = c("time", "group")),
    show.title = F,
    show.x.title = F,
    colors = "bw",
    connect.lines = T,
    line.size = .4,
    dot.size = 3
  ) + scale_shape_manual(values=c(1, 17, 15), name = "Group", labels = c(`xG3text`, xG1, xG2)) + scale_x_continuous(labels=c(xT1, xT2, xT3, `xT4text`))
lsas_sum.emm.plot <- lsas_sum.emm.plot +
  labs(y = "Liebowitz Social Anxiety Scale (LSAS-SR)") + theme_apa(legend.pos = "bottomleft", legend.font.size = 12, y.font.size = 10) +
  geom_hline(yintercept = lsas_sum.emm.plot$data$predicted[4], linetype="dotted")

phq_sum.post.lmer <-
  lmerTest::lmer(
    phq_sum ~ group * time + (1 | subject),
    data = r2fu.long.data[lnT4,],
    na.action = na.omit,
    REML = T
  )
# performance::check_model(phq_sum.lmer) # Checked, found to be OK!
phq_sum.post.anova <- anova(phq_sum.post.lmer, type=3, ddf="Kenward-Roger") # Significant interaction time x group
phq_sum.lmer <-
  lmerTest::lmer(
    phq_sum ~ group * time + (1 | subject),
    data = r2fu.long.data,
    na.action = na.omit,
    REML = T
  )
# performance::check_model(phq_sum.lmer) # Checked, found to be OK!
phq_sum.anova <- anova(phq_sum.lmer, type=3, ddf="Kenward-Roger")
phq_sum.emm.plot <-
  plot(
    ggemmeans(phq_sum.lmer, terms = c("time", "group")),
    show.title = F,
    show.x.title = F,
    colors = "bw",
    connect.lines = T,
    line.size = .4,
    dot.size = 3
  ) + scale_shape_manual(values=c(1, 17, 15), name = "Group", labels = c(`xG3text`, xG1, xG2)) + scale_x_continuous(labels=c(xT1, xT2, xT3, `xT4text`))
phq_sum.emm.plot <- phq_sum.emm.plot +
  labs(y = "Patient Health Questionnaire, 9 items (PHQ-9)") + theme_apa(legend.pos = "bottomleft", legend.font.size = 12, y.font.size = 10) +
  geom_hline(yintercept = phq_sum.emm.plot$data$predicted[1], linetype="dotted")

gad_sum.post.lmer <-
  lmerTest::lmer(
    gad_sum ~ group * time + (1 | subject),
    data = r2fu.long.data[lnT4,],
    na.action = na.omit,
    REML = T
  )
# performance::check_model(gad_sum.post.lmer) # Checked, found to be OK!
gad_sum.post.anova <- anova(gad_sum.post.lmer, type=3, ddf="Kenward-Roger") # Significant interaction time x group
gad_sum.lmer <-
  lmerTest::lmer(
    gad_sum ~ group * time + (1 | subject),
    data = r2fu.long.data,
    na.action = na.omit,
    REML = T
  )
# performance::check_model(gad_sum.lmer) # Checked, found to be OK!
gad_sum.anova <- anova(gad_sum.lmer, type=3, ddf="Kenward-Roger")
gad_sum.emm.plot <-
  plot(
    ggemmeans(gad_sum.lmer, terms = c("time", "group")),
    show.title = F,
    show.x.title = F,
    colors = "bw",
    connect.lines = T,
    line.size = .4,
    dot.size = 3
  ) + scale_shape_manual(values=c(1, 17, 15), name = "Group", labels = c(`xG3text`, xG1, xG2)) + scale_x_continuous(labels=c(xT1, xT2, xT3, `xT4text`))
gad_sum.emm.plot <- gad_sum.emm.plot + labs(y = "Generalised Anxiety Disorder 7-item Scale (GAD-7)") + theme_apa(legend.pos = "bottomleft", legend.font.size = 12, y.font.size = 10) + geom_hline(yintercept = gad_sum.emm.plot$data$predicted[4], linetype="dotted")

well.post.lmer <-
  lmerTest::lmer(
    well ~ group * time + (1 | subject),
    data = r2fu.long.data[lnT4,],
    na.action = na.omit,
    REML = T
  )
# performance::check_model(gad_sum.post.lmer) # Checked, issues with linearity?
well.post.anova <- anova(well.post.lmer, type=3, ddf="Kenward-Roger") # Significant interaction time x group
well.lmer <-
  lmerTest::lmer(
    well ~ group * time + (1 | subject),
    data = r2fu.long.data,
    na.action = na.omit,
    REML = T
  )
# performance::check_model(gad_sum.lmer) # Checked, found to be OK!
well.anova <- anova(well.lmer, type=3, ddf="Kenward-Roger")
well.emm.plot <-
  plot(
    ggemmeans(well.lmer, terms = c("time", "group")),
    show.title = F,
    show.x.title = F,
    colors = "bw",
    connect.lines = T,
    line.size = .4,
    dot.size = 3
  ) + scale_shape_manual(values=c(1, 17, 15), name = "Group", labels = c(`xG3text`, xG1, xG2)) + scale_x_continuous(labels=c(xT1, xT2, xT3, `xT4text`))
well.emm.plot <- well.emm.plot + labs(y = "Questionnaire on well-being") + theme_apa(legend.pos = "topleft", legend.font.size = 12, y.font.size = 10) + geom_hline(yintercept = well.emm.plot$data$predicted[1], linetype="dotted")


```

```{r emmeff, echo = F, eval = T}

effsel.group <- c(1:3,5:8,9:12)
effsel.time <- -10

```

```{r emm.primary.plots, fig.width = 10, fig.asp = 0.8, echo = F, fig.cap = 'Plots of the estimated fixed effects for the primary transdiagnostic scales used to measure skillful, assertive behavior, and aggressive assertive behavior. The participants’ estimated means for all three measures exhibited increasing levels of assertiveness during treatment in the unguided self-help and guided self-help groups, with negligible differences between the two treatment conditions.'}

(aaas_ad.emm.plot + theme(plot.margin = unit(c(0,8,8,0), "pt"))) +
  (aaas_ag.emm.plot + theme(plot.margin = unit(c(0,0,8,8), "pt"))) +
  (rathus.emm.plot + theme(plot.margin = unit(c(8,8,0,0), "pt"))) +
  guide_area() + plot_layout(guides = 'collect') + plot_layout(ncol = 2)

```

```{r emm.secondary.plots, fig.width = 10, fig.asp = 0.8, echo = F, fig.cap = 'Plots of the estimated fixed effects for the secondary syndromal outcome measures, as well as for the general well-being measure. Participation in the unguided self-help and guided self-help conditions led to significant symptom alleviation between the pre and post time points as well as between the pre and one-year follow-up time points for depression and social anxiety. Participation in both treatment groups also led to significant increases in well-being. As with the transdiagnostic measures of assertive behavior, the differences between the post and follow-up time points were statistically inappreciable for all measures, in both treatment groups. The wait-list control group did not significantly change between any time points for either measure. However, to stay on the conservative side and counteract even the slightest nocebo effect of the wait-list condition, the most conservative estimate for the wait-list control condition was used in each follow-up between-group comparison; see the dotted line for a visual representation of the selected time point.'}

# (phq_sum.emm.plot + theme(plot.margin = unit(c(0,8,0,0), "pt"))) +
#   (gad_sum.emm.plot + theme(plot.margin = unit(c(0,0,0,8), "pt"))) +
#   (lsas_sum.emm.plot + theme(plot.margin = unit(c(0,8,0,0), "pt"))) + 
#   guide_area() + plot_layout(guides = 'collect') + plot_layout(ncol = 2) 

(phq_sum.emm.plot + theme(plot.margin = unit(c(0,8,8,0), "pt"))) +
  (gad_sum.emm.plot + theme(plot.margin = unit(c(0,0,8,8), "pt"))) +
  (lsas_sum.emm.plot + theme(plot.margin = unit(c(8,8,0,0), "pt"))) + 
  (well.emm.plot + theme(plot.margin = unit(c(8,0,0,8), "pt"))) +
  plot_layout(ncol = 2) 

```

```{r measures, echo = F, eval = T}

### AAA-S Adaptive assertiveness
# Norms: Thompson (2011) 
# Adaptive assertiveness
# Student sample 1: 57.6 (7.5), alpha .82 <- Let's use these
# Student sample 2: 56.8 (7.4), alpha .82
# Clinical sample: 50.0 (8.4), alpha .69
r.AAAS_ad = 0.82 # s 329 @Thompson2011
sd.AAAS_ad.norm = 7.5 # s 329 @Thompson2011
mean.AAAS_ad.norm = 57.6 # s 329 @Thompson2011
ref.AAAS_ad = "icke-kliniskt stickprov (student-sample 1) från @Thompson2011"

### AAA-S Aggressive assertiveness
# Norms: Thompson (2011) 
# Aggressive assertiveness
# Student sample 1: 33.2 (9.7), alpha .88 <- Let's use these
# Student sample 2: 31.6 (8.7), alpha .87
# Clinical sample: 27.5 (7.6), alpha .82
r.AAAS_ag = 0.88 # s 329 @Thompson2011
sd.AAAS_ag.norm = 9.7 # s 329 @Thompson2011
mean.AAAS_ag.norm = 33.2 # s 329 @Thompson2011
ref.AAAS_ag = "icke-kliniskt stickprov (student-sample 1) från @Thompson2011"

### PHQ9
# Normdata: Kroenke, K., Spitzer, R. L., & Williams, J. B. (2001). The PHQ-9: validity of a brief depression severity measure. Journal of General Internal Medicine, 16(9), 606–613. Retrieved from http://www.ncbi.nlm.nih.gov/pubmed/11556941
r.PHQ9 = 0.89 # @Kroenke2001 s 3
sd.PHQ9.norm = 3.8 # @Kroenke2001 s 3
mean.PHQ9.norm = 3.3 # @Kroenke2001 s 3
ref.PHQ9 = "icke-kliniskt stickprov från @Kroenke2001"

### GAD7
# Normdata: Spitzer, R. L., Kroenke, K., Williams, J. B. W., & Löwe, B. (2006). A Brief Measure for Assessing Generalized Anxiety Disorder. Archives of Internal Medicine, 166(10), 1092. https://doi.org/10.1001/archinte.166.10.1092
# Löwe, B., Decker, O., Müller, S., Brähler, E., Schellberg, D., Herzog, W., & Herzberg, P. Y. (2008). Validation and Standardization of the Generalized Anxiety Disorder Screener (GAD-7) in the General Population. Medical Care, 46(3), 266–274. https://doi.org/10.1097/MLR.0b013e318160d093
r.GAD7 = 0.92 # @Kroenke2006 s 3
sd.GAD7.norm = 4.8 # @Kroenke2006 s 3
mean.GAD7.norm = 4.9 # @Kroenke2006 s 3
ref.PHQ9 = "icke-kliniskt stickprov från @Kroenke2006"

### LSAS-24
# Normdata: Fresco, D. M., Coles, M. E., Heimberg, R. G., Liebowitz, M. R., Hami, S., Stein, M. B., & Goetz, D. (2001). The Liebowitz Social Anxiety Scale: a comparison of the psychometric properties of self-report and clinician-administered formats. Psychol Med 31, 1025-1035.
# Svenska normer: https://www.fbanken.se/form/34/liebowitz-social-anxiety-scale-self-report
r.LSAS24 = 0.96 # @Fresco2001 s 1026
sd.LSAS24.norm = 12.70 # @Fresco2001 s 1031
mean.LSAS24.norm = 13.49 # @Fresco2001 s 1031
ref.LSAS24 = "icke-kliniskt stickprov från @Fresco2001"

### Rathus
# Normdata: Thompson (2011) 
r.Rathus = 0.87 # s 326 @Thompson2011
sd.Rathus.norm = 23.9 # s 326 @Thompson2011
mean.Rathus.norm = 6.2 # s 326 @Thompson2011
ref.Rathus = "icke-kliniskt stickprov (student-sample 1) från @Thompson2011"

### Questionnaire on well-being
# Normer Braconier2015
# Icke-klinisk population (N=163)
#     Medel = 43,81
#     SD = 11,75
r.Well = 0.8 # ICC; @Braconier2015
sd.Well.norm = 11.75 # @Braconier2015
mean.Well.norm = 43.81 # @Braconier2015
ref.Well = "icke-kliniskt stickprov från @Braconier2015"

measurementnames <-
  c("AAA-S Adaptive",
    "AAA-S Aggressive",
    "RAS",
    "PHQ-9",
    "GAD-7",
    "LSAS-SR",
    "Well-being")

measurementshortnames <-
  c("aaas_ad",
    "aaas_ag",
    "rathus",
    "phq_sum",
    "gad_sum",
    "lsas_sum",
    "well")

norms <- rbind(
  c(r.AAAS_ad, mean.AAAS_ad.norm, sd.AAAS_ad.norm),
  c(r.AAAS_ag, mean.AAAS_ag.norm, sd.AAAS_ag.norm),
  c(r.Rathus, mean.Rathus.norm, sd.Rathus.norm),
  c(r.PHQ9, mean.PHQ9.norm, sd.PHQ9.norm),
  c(r.GAD7, mean.GAD7.norm, sd.GAD7.norm),
  c(r.LSAS24, mean.LSAS24.norm, sd.LSAS24.norm),
  c(r.Well, mean.Well.norm, sd.Well.norm)
)

```

```{r collectoutput, echo = F, eval = T}

aaas_ad.out <- rout(aaas_ad.lmer)
aaas_ag.out <- rout(aaas_ag.lmer)
rathus.out <- rout(rathus.lmer)
phq_sum.out <- rout(phq_sum.lmer)
gad_sum.out <- rout(gad_sum.lmer)
lsas_sum.out <- rout(lsas_sum.lmer)
well.out <- rout(well.lmer)

```

```{r buildeffsizetab, echo = F, eval = T}

comparison.long <- c(
  "Unguided self-help, Pre vs. Post",
  "Unguided self-help, Pre vs. Follow-up",
  "Unguided self-help, Post vs. Follow-up",
  "Guided self-help, Pre vs. Post",
  "Guided self-help, Pre vs. Follow-up",
  "Guided self-help, Post vs. Follow-up",
  "Wait-list, Pre vs. Post",
  "Unguided self-help at Post vs. Wait-list at Post",
  "Unguided self-help at Follow-up vs. Wait-list at Post",
  "Unguided self-help at Follow-up vs. Wait-list at \\dag",
  "Guided self-help at Post vs. Wait-list at Post",
  "Guided self-help at Follow-up vs. Wait-list at Post",
  "Guided self-help at Follow-up vs. Wait-list at \\dag",
  "Guided self-help at Post vs. Unguided at Post",
  "Guided self-help at Follow-up vs. Unguided at Follow-up"
  )

comparison <- c(
  "Unguided, Pre vs. Post",
  "Unguided, Pre vs. Follow-up",
  "Unguided, Post vs. Follow-up",
  "Guided, Pre vs. Post",
  "Guided, Pre vs. Follow-up",
  "Guided, Post vs. Follow-up",
  "Wait-list, Pre vs. Post",
  "Unguided at Post vs. Wait-list at Post",
  "Unguided at Follow-up vs. Wait-list at Post",
  "Unguided at Follow-up vs. Wait-list at \\dag",
  "Guided at Post vs. Wait-list at Post",
  "Guided at Follow-up vs. Wait-list at Post",
  "Guided at Follow-up vs. Wait-list at \\dag",
  "Guided vs. Unguided at Post",
  "Guided vs. Unguided at Follow-up"
  )

aaas_ad.effsizes <-
  c(
    effsize.tabrow2(aaas_ad.out,paste(xT1,xG1,"-",xT3,xG1),-1),
    effsize.tabrow2(aaas_ad.out,paste(xT1,xG1,"-",xT4,xG1),-1),
    effsize.tabrow2(aaas_ad.out,paste(xT3,xG1,"-",xT4,xG1),-1),
    effsize.tabrow2(aaas_ad.out,paste(xT1,xG2,"-",xT3,xG2),-1),
    effsize.tabrow2(aaas_ad.out,paste(xT1,xG2,"-",xT4,xG2),-1),
    effsize.tabrow2(aaas_ad.out,paste(xT3,xG2,"-",xT4,xG2),-1),
    effsize.tabrow2(aaas_ad.out,paste(xT1,xG3,"-",xT3,xG3),-1),
    effsize.tabrow2(aaas_ad.out,paste(xT3,xG3,"-",xT3,xG1),-1),
    effsize.tabrow2(aaas_ad.out,paste(xT3,xG3,"-",xT4,xG1),-1),
    "\\parbox{10.5em}{\\hfil{}(idem)\\hfil{}}",
    effsize.tabrow2(aaas_ad.out,paste(xT3,xG3,"-",xT3,xG2),-1),
    effsize.tabrow2(aaas_ad.out,paste(xT3,xG3,"-",xT4,xG2),-1),
    "\\parbox{10.5em}{\\hfil{}(idem)\\hfil{}}",
    effsize.tabrow2(aaas_ad.out,paste(xT3,xG1,"-",xT3,xG2),-1),
    effsize.tabrow2(aaas_ad.out,paste(xT4,xG1,"-",xT4,xG2),-1)
  )

aaas_ag.effsizes <-
  c(
    effsize.tabrow2(aaas_ag.out,paste(xT1,xG1,"-",xT3,xG1),1),
    effsize.tabrow2(aaas_ag.out,paste(xT1,xG1,"-",xT4,xG1),1),
    effsize.tabrow2(aaas_ag.out,paste(xT3,xG1,"-",xT4,xG1),1),
    effsize.tabrow2(aaas_ag.out,paste(xT1,xG2,"-",xT3,xG2),1),
    effsize.tabrow2(aaas_ag.out,paste(xT1,xG2,"-",xT4,xG2),1),
    effsize.tabrow2(aaas_ag.out,paste(xT3,xG2,"-",xT4,xG2),1),
    effsize.tabrow2(aaas_ag.out,paste(xT1,xG3,"-",xT3,xG3),1),
    effsize.tabrow2(aaas_ag.out,paste(xT3,xG3,"-",xT3,xG1),1),
    effsize.tabrow2(aaas_ag.out,paste(xT3,xG3,"-",xT4,xG1),1),
    "\\parbox{10.5em}{\\hfil{}(idem)\\hfil{}}",
    effsize.tabrow2(aaas_ag.out,paste(xT3,xG3,"-",xT3,xG2),1),
    effsize.tabrow2(aaas_ag.out,paste(xT3,xG3,"-",xT4,xG2),1),
    "\\parbox{10.5em}{\\hfil{}(idem)\\hfil{}}",
    effsize.tabrow2(aaas_ag.out,paste(xT3,xG1,"-",xT3,xG2),1),
    effsize.tabrow2(aaas_ag.out,paste(xT4,xG1,"-",xT4,xG2),1)
  )

rathus.effsizes <-
  c(
    effsize.tabrow2(rathus.out,paste(xT1,xG1,"-",xT3,xG1),-1),
    effsize.tabrow2(rathus.out,paste(xT1,xG1,"-",xT4,xG1),-1),
    effsize.tabrow2(rathus.out,paste(xT3,xG1,"-",xT4,xG1),-1),
    effsize.tabrow2(rathus.out,paste(xT1,xG2,"-",xT3,xG2),-1),
    effsize.tabrow2(rathus.out,paste(xT1,xG2,"-",xT4,xG2),-1), 
    effsize.tabrow2(rathus.out,paste(xT3,xG2,"-",xT4,xG2),-1),
    effsize.tabrow2(rathus.out,paste(xT1,xG3,"-",xT3,xG3),-1),
    effsize.tabrow2(rathus.out,paste(xT3,xG3,"-",xT3,xG1),-1),
    effsize.tabrow2(rathus.out,paste(xT3,xG3,"-",xT4,xG1),-1),
    "\\parbox{10.5em}{\\hfil{}(idem)\\hfil{}}",
    effsize.tabrow2(rathus.out,paste(xT3,xG3,"-",xT3,xG2),-1),
    effsize.tabrow2(rathus.out,paste(xT3,xG3,"-",xT4,xG2),-1),
    "\\parbox{10.5em}{\\hfil{}(idem)\\hfil{}}",
    effsize.tabrow2(rathus.out,paste(xT3,xG1,"-",xT3,xG2),-1),
    effsize.tabrow2(rathus.out,paste(xT4,xG1,"-",xT4,xG2),-1)
  )

phq_sum.effsizes <-
  c(
    effsize.tabrow2(phq_sum.out,paste(xT1,xG1,"-",xT3,xG1),1),
    effsize.tabrow2(phq_sum.out,paste(xT1,xG1,"-",xT4,xG1),1),
    effsize.tabrow2(phq_sum.out,paste(xT3,xG1,"-",xT4,xG1),1),
    effsize.tabrow2(phq_sum.out,paste(xT1,xG2,"-",xT3,xG2),1),
    effsize.tabrow2(phq_sum.out,paste(xT1,xG2,"-",xT4,xG2),1),
    effsize.tabrow2(phq_sum.out,paste(xT3,xG2,"-",xT4,xG2),1),
    effsize.tabrow2(phq_sum.out,paste(xT1,xG3,"-",xT3,xG3),1),
    effsize.tabrow2(phq_sum.out,paste(xT3,xG3,"-",xT3,xG1),1),
    effsize.tabrow2(phq_sum.out,paste(xT3,xG3,"-",xT4,xG1),1),
    effsize.tabrow2(phq_sum.out,paste(xT1,xG3,"-",xT4,xG1),1), #levels(r2fu.long.data$time)[which.min(phq_sum.emm.plot$data$predicted[c(1,4,7)])]
    effsize.tabrow2(phq_sum.out,paste(xT3,xG3,"-",xT3,xG2),1),
    effsize.tabrow2(phq_sum.out,paste(xT3,xG3,"-",xT4,xG2),1),
    effsize.tabrow2(phq_sum.out,paste(xT1,xG3,"-",xT4,xG2),1), #levels(r2fu.long.data$time)[which.min(phq_sum.emm.plot$data$predicted[c(1,4,7)])]
    effsize.tabrow2(phq_sum.out,paste(xT3,xG1,"-",xT3,xG2),1),
    effsize.tabrow2(phq_sum.out,paste(xT4,xG1,"-",xT4,xG2),1)
  )

gad_sum.effsizes <-
  c(
    effsize.tabrow2(gad_sum.out,paste(xT1,xG1,"-",xT3,xG1),1),
    effsize.tabrow2(gad_sum.out,paste(xT1,xG1,"-",xT4,xG1),1),
    effsize.tabrow2(gad_sum.out,paste(xT3,xG1,"-",xT4,xG1),1),
    effsize.tabrow2(gad_sum.out,paste(xT1,xG2,"-",xT3,xG2),1),
    effsize.tabrow2(gad_sum.out,paste(xT1,xG2,"-",xT4,xG2),1),
    effsize.tabrow2(gad_sum.out,paste(xT3,xG2,"-",xT4,xG2),1),
    effsize.tabrow2(gad_sum.out,paste(xT1,xG3,"-",xT3,xG3),1),
    effsize.tabrow2(gad_sum.out,paste(xT3,xG3,"-",xT3,xG1),1),
    effsize.tabrow2(gad_sum.out,paste(xT3,xG3,"-",xT4,xG1),1),
    effsize.tabrow2(gad_sum.out,paste(xT2,xG3,"-",xT4,xG1),1), #levels(r2fu.long.data$time)[which.min(gad_sum.emm.plot$data$predicted[c(1,4,7)])]
    effsize.tabrow2(gad_sum.out,paste(xT3,xG3,"-",xT3,xG2),1),
    effsize.tabrow2(gad_sum.out,paste(xT3,xG3,"-",xT4,xG2),1),
    effsize.tabrow2(gad_sum.out,paste(xT2,xG3,"-",xT4,xG2),1), #levels(r2fu.long.data$time)[which.min(gad_sum.emm.plot$data$predicted[c(1,4,7)])]
    effsize.tabrow2(gad_sum.out,paste(xT3,xG1,"-",xT3,xG2),1),
    effsize.tabrow2(gad_sum.out,paste(xT4,xG1,"-",xT4,xG2),1)
  )

lsas_sum.effsizes <-
  c(
    effsize.tabrow2(lsas_sum.out,paste(xT1,xG1,"-",xT3,xG1),1),
    effsize.tabrow2(lsas_sum.out,paste(xT1,xG1,"-",xT4,xG1),1),
    effsize.tabrow2(lsas_sum.out,paste(xT3,xG1,"-",xT4,xG1),1),
    effsize.tabrow2(lsas_sum.out,paste(xT1,xG2,"-",xT3,xG2),1),
    effsize.tabrow2(lsas_sum.out,paste(xT1,xG2,"-",xT4,xG2),1),
    effsize.tabrow2(lsas_sum.out,paste(xT3,xG2,"-",xT4,xG2),1),
    effsize.tabrow2(lsas_sum.out,paste(xT1,xG3,"-",xT3,xG3),1),
    effsize.tabrow2(lsas_sum.out,paste(xT3,xG3,"-",xT3,xG1),1),
    effsize.tabrow2(lsas_sum.out,paste(xT3,xG3,"-",xT4,xG1),1),
    effsize.tabrow2(lsas_sum.out,paste(xT2,xG3,"-",xT4,xG1),1), #levels(r2fu.long.data$time)[which.min(lsas_sum.emm.plot$data$predicted[c(1,4,7)])]
    effsize.tabrow2(lsas_sum.out,paste(xT3,xG3,"-",xT3,xG2),1),
    effsize.tabrow2(lsas_sum.out,paste(xT3,xG3,"-",xT4,xG2),1),
    effsize.tabrow2(lsas_sum.out,paste(xT2,xG3,"-",xT4,xG2),1), #levels(r2fu.long.data$time)[which.min(lsas_sum.emm.plot$data$predicted[c(1,4,7)])]
    effsize.tabrow2(lsas_sum.out,paste(xT3,xG1,"-",xT3,xG2),1),
    effsize.tabrow2(lsas_sum.out,paste(xT4,xG1,"-",xT4,xG2),1)
  )

well.effsizes <-
  c(
    effsize.tabrow2(well.out,paste(xT1,xG1,"-",xT3,xG1),-1),
    effsize.tabrow2(well.out,paste(xT1,xG1,"-",xT4,xG1),-1),
    effsize.tabrow2(well.out,paste(xT3,xG1,"-",xT4,xG1),-1),
    effsize.tabrow2(well.out,paste(xT1,xG2,"-",xT3,xG2),-1),
    effsize.tabrow2(well.out,paste(xT1,xG2,"-",xT4,xG2),-1),
    effsize.tabrow2(well.out,paste(xT3,xG2,"-",xT4,xG2),-1),
    effsize.tabrow2(well.out,paste(xT1,xG3,"-",xT3,xG3),-1),
    effsize.tabrow2(well.out,paste(xT3,xG3,"-",xT3,xG1),-1),
    effsize.tabrow2(well.out,paste(xT3,xG3,"-",xT4,xG1),-1),
    effsize.tabrow2(well.out,paste(xT1,xG3,"-",xT4,xG1),-1), #levels(r2fu.long.data$time)[which.max(lsas_sum.emm.plot$data$predicted[c(1,4,7)])]
    effsize.tabrow2(well.out,paste(xT3,xG3,"-",xT3,xG2),-1),
    effsize.tabrow2(well.out,paste(xT3,xG3,"-",xT4,xG2),-1),
    effsize.tabrow2(well.out,paste(xT1,xG3,"-",xT4,xG2),-1), #levels(r2fu.long.data$time)[which.max(lsas_sum.emm.plot$data$predicted[c(1,4,7)])]
    effsize.tabrow2(well.out,paste(xT3,xG1,"-",xT3,xG2),-1),
    effsize.tabrow2(well.out,paste(xT4,xG1,"-",xT4,xG2),-1)
  )
effectsize.table <- cbind.data.frame(
  comparison,
  aaas_ad.effsizes,
  aaas_ag.effsizes,
  rathus.effsizes,
  phq_sum.effsizes,
  gad_sum.effsizes,
  lsas_sum.effsizes,
  well.effsizes
  )

measurementnamesspecial <- paste0("\\parbox{10em}{\\hfil{}\\hspace{2em}",measurementnames,"\\hfil{}}")
# paste0("\\parbox{10.5em}{\\hfil{}\\hspace{2em}",measurementnames,"\\hfil{}}")

colnames(effectsize.table) <- c(" ",measurementnamesspecial)

```

```{r effsizetab, echo = F, eval = T}

# https://ftp.acc.umu.se/mirror/CTAN/macros/latex/contrib/endfloat/endfloat.pdf p 10
# https://bookdown.org/yihui/rmarkdown-cookbook/kable.html#customize-latex-tables search for "table.envir"
# table.envir = "sidewaystable" # See URLs above
# %>%
#   kableExtra::landscape()

knitr::kable(
  effectsize.table,
  caption = "Within-group effect sizes [95\\% CI] comparing estimated marginal means between Pre- and Post-treatment, as well as between Pre-treatment and 1-year Follow-up, and between group effect sizes [95\\% CI] at Post-treatment and 1-year Follow-up.",
  align = "rlllllll",
  escape = F,
  booktabs = T,
  format = "latex",
  table.envir = "sidewaystable"
) %>%
  kable_styling(full_width = F, font_size = 6.75) %>%
  pack_rows("Within-group effect sizes", 1, 7, bold = F) %>%
  pack_rows("Between-group effect sizes", 8, 15, bold = F) %>%
  row_spec(c(3, 6, 7, 10, 13, 16), extra_latex_after = "\\midrule") %>%
  column_spec(c(1), width = "19em") %>%
  column_spec(c(2:7), width = c("10em","11em","10em","10em","10em","10em")) %>% # 11.5em
  add_header_above(
    c(
      " ",
      "Primary transdiagnostic measures of skillful behavior" = 3,
      "Secondary measures of syndromal symptoms and well-being" = 4
    )
  ) %>%
  footnote(
    general = c(
      "CI = confidence interval",
      "AAA-S Adaptive = Adaptive and Aggressive Assertiveness Scales, Adaptive subscale; AAA-S Aggressive = Adaptive and Aggressive Assertiveness Scales, Aggressive Subscale, RAS = Rathus Assertiveness Schedule; PHQ-9 = Patient Health Questionnaire, 9 items; GAD-7 = Generalised Anxiety Disorder 7-item Scale; LSAS-SR = Liebowitz Social Anxiety Scale; Well-being = Questionnaire on Well-being.",
      "Pre = pre-treatment measurement at 0 weeks; During = measurement during week 4; Post = measurement after completion of treatment at week 8; Follow-up = measurement at 1 year after completion.",
      "\\\\textsuperscript{\\\\dag} = the most conservative measurement for the Wait-list control condition, in order to suppress any nocebo effects; see dotted lines in graphs in Figure 3 for identification of time point.",
      "\\\\textsuperscript{*} = \\\\textit{p} < .05, \\\\textsuperscript{**} = \\\\textit{p} < .01, \\\\textsuperscript{***} = \\\\textit{p} < .00; \\\\textit{p}-values are Bonferroni adjusted, based on pairwise comparisons of all sampled time points and conditions."
    ),
    escape = F,
    general_title = "Notes.",
    footnote_as_chunk = F,
    threeparttable = T
  ) 

```

```{r clinsig, echo = F, eval = T, results='hide'}

# Intention-to-treat data frame
r2fu.itt.data <- r2fu.long.data

# Group keys
ig1 <- grepl(xG1, r2fu.itt.data$group)
ig2 <- grepl(xG2, r2fu.itt.data$group)
ig3 <- grepl(xG3, r2fu.itt.data$group)

# Time keys
it1 <- grepl(xT1, r2fu.itt.data$time)
it2 <- grepl(xT2, r2fu.itt.data$time)
it3 <- grepl(xT3, r2fu.itt.data$time)
it4 <- grepl(xT4, r2fu.itt.data$time)

# Copy values over to empty future time points, starting with Pre --> During and moving forward
# Last observation carried forward
for (xmeasure in measurementshortnames) {
  copyvalues <-
    which(is.na(r2fu.itt.data[it2, xmeasure])) # Pre --> During
  r2fu.itt.data[it2, xmeasure][copyvalues] <-
    r2fu.itt.data[it1, xmeasure][copyvalues]
  copyvalues <-
    which(is.na(r2fu.itt.data[it3, xmeasure])) # During --> Post
  r2fu.itt.data[it3, xmeasure][copyvalues] <-
    r2fu.itt.data[it2, xmeasure][copyvalues]
  copyvalues <-
    which(is.na(r2fu.itt.data[it4, xmeasure])) # Post --> Follow-up
  r2fu.itt.data[it4, xmeasure][copyvalues] <-
    r2fu.itt.data[it3, xmeasure][copyvalues]
}

# Clinical significant change data.frame output
clinsigraw <- function(measure, direction, first, last, group) {
  groupkey <- grepl(group, r2fu.itt.data$group)
  clinsig <- clinical_significance(
    data = r2fu.itt.data[groupkey, ],
    better_is = direction,
    id = subject,
    time = time,
    outcome = measure,
    pre = first,
    post = last,
    reliability = norms[which(measurementshortnames == measure), 1],
    m_functional = norms[which(measurementshortnames == measure), 2],
    sd_functional = norms[which(measurementshortnames == measure), 3],
    type = "c"
  )
  recovered <- clinsig$categories$recovered
  worsened <- clinsig$categories$harmed + clinsig$categories$deteriorated
  return(
    list(
      recovered = as.numeric(recovered),
      harmed = as.numeric(clinsig$categories$harmed),
      deteriorated = as.numeric(clinsig$categories$deteriorated),
      worsened = as.numeric(worsened)
    )
  )
}

## Test statistical significance of clinical significant change Pre --> Post

aaas_ad.pre.post.kw <- dunn.test(list(
  clinsigraw("aaas_ad", "higher", xT1, xT3, xG3)$recovered,
  clinsigraw("aaas_ad", "higher", xT1, xT3, xG1)$recovered,
  clinsigraw("aaas_ad", "higher", xT1, xT3, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 7.9198, df = 2, p-value = 0.02, calls for pairwise comparisons
# $altP.adjusted
# [1] 0.03801518 0.05187877 1.00000000

# aaas_ad.pre.post.kw.worsened <- dunn.test(list(
#   clinsigraw("aaas_ad", "higher", xT1, xT3, xG3)$worsened,
#   clinsigraw("aaas_ad", "higher", xT1, xT3, xG1)$worsened,
#   clinsigraw("aaas_ad", "higher", xT1, xT3, xG2)$worsened
# ), method="bonferroni", altp=TRUE)
# No worsening in any group, nothing to test!

# aaas_ag.pre.post.kw.higher <- dunn.test(list(
#   clinsigraw("aaas_ag", "higher", xT1, xT3, xG3)$recovered,
#   clinsigraw("aaas_ag", "higher", xT1, xT3, xG1)$recovered,
#   clinsigraw("aaas_ag", "higher", xT1, xT3, xG2)$recovered
# ), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 0.1847, df = 2, p-value = 0.91 with direction = "higher"

aaas_ag.pre.post.kw <- dunn.test(list(
  clinsigraw("aaas_ag", "lower", xT1, xT3, xG3)$recovered,
  clinsigraw("aaas_ag", "lower", xT1, xT3, xG1)$recovered,
  clinsigraw("aaas_ag", "lower", xT1, xT3, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 6.104, df = 2, p-value = 0.05
# $altP.adjusted
# [1] 0.09974166 0.09408707 1.00000000 # No significant pairs

# aaas_ag.pre.post.kw.harmed.higher <- dunn.test(list(
#   clinsigraw("aaas_ag", "higher", xT1, xT3, xG3)$harmed,
#   clinsigraw("aaas_ag", "higher", xT1, xT3, xG1)$harmed,
#   clinsigraw("aaas_ag", "higher", xT1, xT3, xG2)$harmed
# ), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 6.104, df = 2, p-value = 0.05, calls for pairwise comparisons
# $altP.adjusted
# [1] 0.09974166 0.09408707 1.00000000; no difference found

aaas_ag.pre.post.kw.harmed <- dunn.test(list(
  clinsigraw("aaas_ag", "lower", xT1, xT3, xG3)$harmed,
  clinsigraw("aaas_ag", "lower", xT1, xT3, xG1)$harmed,
  clinsigraw("aaas_ag", "lower", xT1, xT3, xG2)$harmed
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 0.1847, df = 2, p-value = 0.91

# aaas_ag.pre.post.kw.worsened.higher <- dunn.test(list(
#   clinsigraw("aaas_ag", "higher", xT1, xT3, xG3)$worsened,
#   clinsigraw("aaas_ag", "higher", xT1, xT3, xG1)$worsened,
#   clinsigraw("aaas_ag", "higher", xT1, xT3, xG2)$worsened
# ), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 3.1136, df = 2, p-value = 0.21

aaas_ag.pre.post.kw.worsened <- dunn.test(list(
  clinsigraw("aaas_ag", "lower", xT1, xT3, xG3)$worsened,
  clinsigraw("aaas_ag", "lower", xT1, xT3, xG1)$worsened,
  clinsigraw("aaas_ag", "lower", xT1, xT3, xG2)$worsened
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 1.1106, df = 2, p-value = 0.57

rathus.pre.post.kw <- dunn.test(list(
  clinsigraw("rathus", "higher", xT1, xT3, xG3)$recovered,
  clinsigraw("rathus", "higher", xT1, xT3, xG1)$recovered,
  clinsigraw("rathus", "higher", xT1, xT3, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 14.9234, df = 2, p-value = 0, calls for pairwise comparisons
# $altP.adjusted
# [1] 0.006524832 0.001064018 1.000000000; differences found

# rathus.pre.post.kw.worsened <- dunn.test(list(
#   clinsigraw("rathus", "higher", xT1, xT3, xG3)$worsened,
#   clinsigraw("rathus", "higher", xT1, xT3, xG1)$worsened,
#   clinsigraw("rathus", "higher", xT1, xT3, xG2)$worsened
# ), method="bonferroni", altp=TRUE)
# No worsening in any group, nothing to test!

phq_sum.pre.post.kw <- dunn.test(list(
  clinsigraw("phq_sum", "lower", xT1, xT3, xG3)$recovered,
  clinsigraw("phq_sum", "lower", xT1, xT3, xG1)$recovered,
  clinsigraw("phq_sum", "lower", xT1, xT3, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 9.6651, df = 2, p-value = 0.01, calls for pairwise comparisons
# $altP.adjusted
# [1] 0.241241515 0.005787945 0.552125729; differences found

phq_sum.pre.post.kw.harmed <- dunn.test(list(
  clinsigraw("phq_sum", "lower", xT1, xT3, xG3)$harmed,
  clinsigraw("phq_sum", "lower", xT1, xT3, xG1)$harmed,
  clinsigraw("phq_sum", "lower", xT1, xT3, xG2)$harmed
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 0.9316, df = 2, p-value = 0.63

phq_sum.pre.post.kw.worsened <- dunn.test(list(
  clinsigraw("phq_sum", "lower", xT1, xT3, xG3)$worsened,
  clinsigraw("phq_sum", "lower", xT1, xT3, xG1)$worsened,
  clinsigraw("phq_sum", "lower", xT1, xT3, xG2)$worsened
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 5.0582, df = 2, p-value = 0.08

gad_sum.pre.post.kw <- dunn.test(list(
  clinsigraw("gad_sum", "lower", xT1, xT3, xG3)$recovered,
  clinsigraw("gad_sum", "lower", xT1, xT3, xG1)$recovered,
  clinsigraw("gad_sum", "lower", xT1, xT3, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 2.0239, df = 2, p-value = 0.36

gad_sum.pre.post.kw.harmed <- dunn.test(list(
  clinsigraw("gad_sum", "lower", xT1, xT3, xG3)$harmed,
  clinsigraw("gad_sum", "lower", xT1, xT3, xG1)$harmed,
  clinsigraw("gad_sum", "lower", xT1, xT3, xG2)$harmed
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 2.9776, df = 2, p-value = 0.23

gad_sum.pre.post.kw.worsened <- dunn.test(list(
  clinsigraw("gad_sum", "lower", xT1, xT3, xG3)$worsened,
  clinsigraw("gad_sum", "lower", xT1, xT3, xG1)$worsened,
  clinsigraw("gad_sum", "lower", xT1, xT3, xG2)$worsened
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 5.8257, df = 2, p-value = 0.05, calls for pairwise comparisons
# $altP.adjusted
# [1] 0.96895090 0.04909457 0.48795293; differences found

lsas_sum.pre.post.kw <- dunn.test(list(
  clinsigraw("lsas_sum", "lower", xT1, xT3, xG3)$recovered,
  clinsigraw("lsas_sum", "lower", xT1, xT3, xG1)$recovered,
  clinsigraw("lsas_sum", "lower", xT1, xT3, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 7.5439, df = 2, p-value = 0.02, calls for pairwise comparisons
# $altP.adjusted
# [1] 0.04540113 0.05980064 1.00000000

lsas_sum.pre.post.kw.harmed <- dunn.test(list(
  clinsigraw("lsas_sum", "lower", xT1, xT3, xG3)$harmed,
  clinsigraw("lsas_sum", "lower", xT1, xT3, xG1)$harmed,
  clinsigraw("lsas_sum", "lower", xT1, xT3, xG2)$harmed
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 2.0597, df = 2, p-value = 0.36

lsas_sum.pre.post.kw.worsened <- dunn.test(list(
  clinsigraw("lsas_sum", "lower", xT1, xT3, xG3)$worsened,
  clinsigraw("lsas_sum", "lower", xT1, xT3, xG1)$worsened,
  clinsigraw("lsas_sum", "lower", xT1, xT3, xG2)$worsened
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 9.1314, df = 2, p-value = 0.01, calls for pairwise comparisons
# $altP.adjusted
# [1] 0.11608446 0.00972895 1.00000000; differences found

well.pre.post.kw <- dunn.test(list(
  clinsigraw("well", "higher", xT1, xT3, xG3)$recovered,
  clinsigraw("well", "higher", xT1, xT3, xG1)$recovered,
  clinsigraw("well", "higher", xT1, xT3, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 5.1068, df = 2, p-value = 0.08

well.pre.post.kw.harmed <- dunn.test(list(
  clinsigraw("well", "higher", xT1, xT3, xG3)$harmed,
  clinsigraw("well", "higher", xT1, xT3, xG1)$harmed,
  clinsigraw("well", "higher", xT1, xT3, xG2)$harmed
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 6.3683, df = 2, p-value = 0.04

well.pre.post.kw.worsened <- dunn.test(list(
  clinsigraw("well", "higher", xT1, xT3, xG3)$worsened,
  clinsigraw("well", "higher", xT1, xT3, xG1)$worsened,
  clinsigraw("well", "higher", xT1, xT3, xG2)$worsened
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 3.7677, df = 2, p-value = 0.15

## Test statistical significance of clinical significant change Pre --> Follow-up

aaas_ad.pre.fu.kw <- dunn.test(list(
  clinsigraw("aaas_ad", "higher", xT1, xT4, xG3)$recovered,
  clinsigraw("aaas_ad", "higher", xT1, xT4, xG1)$recovered,
  clinsigraw("aaas_ad", "higher", xT1, xT4, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 12.3534, df = 2, p-value = 0, calls for pairwise comparisons
# $altP.adjusted
# [1] 0.01854809 0.00311267 1.00000000; differences found

# aaas_ad.pre.fu.kw.worsened <- dunn.test(list(
#   clinsigraw("aaas_ad", "higher", xT1, xT4, xG3)$worsened,
#   clinsigraw("aaas_ad", "higher", xT1, xT4, xG1)$worsened,
#   clinsigraw("aaas_ad", "higher", xT1, xT4, xG2)$worsened
# ), method="bonferroni", altp=TRUE)
# No worsening in any group, nothing to test!

# aaas_ag.pre.fu.kw.higher <- dunn.test(list(
#   clinsigraw("aaas_ag", "higher", xT1, xT4, xG3)$recovered,
#   clinsigraw("aaas_ag", "higher", xT1, xT4, xG1)$recovered,
#   clinsigraw("aaas_ag", "higher", xT1, xT4, xG2)$recovered
# ), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 1.7287, df = 2, p-value = 0.42

aaas_ag.pre.fu.kw <- dunn.test(list(
  clinsigraw("aaas_ag", "lower", xT1, xT4, xG3)$recovered,
  clinsigraw("aaas_ag", "lower", xT1, xT4, xG1)$recovered,
  clinsigraw("aaas_ag", "lower", xT1, xT4, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 3.5677, df = 2, p-value = 0.17

# aaas_ag.pre.fu.kw.harmed.higher <- dunn.test(list(
#   clinsigraw("aaas_ag", "higher", xT1, xT4, xG3)$harmed,
#   clinsigraw("aaas_ag", "higher", xT1, xT4, xG1)$harmed,
#   clinsigraw("aaas_ag", "higher", xT1, xT4, xG2)$harmed
# ), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 3.5677, df = 2, p-value = 0.17

aaas_ag.pre.fu.kw.harmed <- dunn.test(list(
  clinsigraw("aaas_ag", "lower", xT1, xT4, xG3)$harmed,
  clinsigraw("aaas_ag", "lower", xT1, xT4, xG1)$harmed,
  clinsigraw("aaas_ag", "lower", xT1, xT4, xG2)$harmed
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 1.7287, df = 2, p-value = 0.42

# aaas_ag.pre.fu.kw.worsened.higher <- dunn.test(list(
#   clinsigraw("aaas_ag", "higher", xT1, xT4, xG3)$worsened,
#   clinsigraw("aaas_ag", "higher", xT1, xT4, xG1)$worsened,
#   clinsigraw("aaas_ag", "higher", xT1, xT4, xG2)$worsened
# ), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 4.0919, df = 2, p-value = 0.13

aaas_ag.pre.fu.kw.worsened <- dunn.test(list(
  clinsigraw("aaas_ag", "lower", xT1, xT4, xG3)$worsened,
  clinsigraw("aaas_ag", "lower", xT1, xT4, xG1)$worsened,
  clinsigraw("aaas_ag", "lower", xT1, xT4, xG2)$worsened
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 3.2728, df = 2, p-value = 0.19

rathus.pre.fu.kw <- dunn.test(list(
  clinsigraw("rathus", "higher", xT1, xT4, xG3)$recovered,
  clinsigraw("rathus", "higher", xT1, xT4, xG1)$recovered,
  clinsigraw("rathus", "higher", xT1, xT4, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 21.5053, df = 2, p-value = 0, calls for pairwise comparisons
# $altP.adjusted
# [1] 7.582296e-04 5.122463e-05 1.000000e+00; differences found

# rathus.pre.fu.kw.worsened <- dunn.test(list(
#   clinsigraw("rathus", "higher", xT1, xT4, xG3)$worsened,
#   clinsigraw("rathus", "higher", xT1, xT4, xG1)$worsened,
#   clinsigraw("rathus", "higher", xT1, xT4, xG2)$worsened
# ), method="bonferroni", altp=TRUE)
# No worsening in any group, nothing to test!

phq_sum.pre.fu.kw <- dunn.test(list(
  clinsigraw("phq_sum", "lower", xT1, xT4, xG3)$recovered,
  clinsigraw("phq_sum", "lower", xT1, xT4, xG1)$recovered,
  clinsigraw("phq_sum", "lower", xT1, xT4, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 11.8735, df = 2, p-value = 0, calls for pairwise comparisons
# $altP.adjusted
# [1] 0.16571305 0.00175382 0.40476336; differences found

phq_sum.pre.fu.kw.harmed <- dunn.test(list(
  clinsigraw("phq_sum", "lower", xT1, xT4, xG3)$harmed,
  clinsigraw("phq_sum", "lower", xT1, xT4, xG1)$harmed,
  clinsigraw("phq_sum", "lower", xT1, xT4, xG2)$harmed
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 1.2129, df = 2, p-value = 0.55

phq_sum.pre.fu.kw.worsened <- dunn.test(list(
  clinsigraw("phq_sum", "lower", xT1, xT4, xG3)$worsened,
  clinsigraw("phq_sum", "lower", xT1, xT4, xG1)$worsened,
  clinsigraw("phq_sum", "lower", xT1, xT4, xG2)$worsened
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 7.8589, df = 2, p-value = 0.02, calls for pairwise comparisons
# $altP.adjusted
# [1] 0.01522904 0.41861314 0.53078210; differences found

gad_sum.pre.fu.kw <- dunn.test(list(
  clinsigraw("gad_sum", "lower", xT1, xT4, xG3)$recovered,
  clinsigraw("gad_sum", "lower", xT1, xT4, xG1)$recovered,
  clinsigraw("gad_sum", "lower", xT1, xT4, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 5.123, df = 2, p-value = 0.08

gad_sum.pre.fu.kw.harmed <- dunn.test(list(
  clinsigraw("gad_sum", "lower", xT1, xT4, xG3)$harmed,
  clinsigraw("gad_sum", "lower", xT1, xT4, xG1)$harmed,
  clinsigraw("gad_sum", "lower", xT1, xT4, xG2)$harmed
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 2.1993, df = 2, p-value = 0.33

gad_sum.pre.fu.kw.worsened <- dunn.test(list(
  clinsigraw("gad_sum", "lower", xT1, xT4, xG3)$worsened,
  clinsigraw("gad_sum", "lower", xT1, xT4, xG1)$worsened,
  clinsigraw("gad_sum", "lower", xT1, xT4, xG2)$worsened
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 2.5818, df = 2, p-value = 0.28

lsas_sum.pre.fu.kw <- dunn.test(list(
  clinsigraw("lsas_sum", "lower", xT1, xT4, xG3)$recovered,
  clinsigraw("lsas_sum", "lower", xT1, xT4, xG1)$recovered,
  clinsigraw("lsas_sum", "lower", xT1, xT4, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 14.1971, df = 2, p-value = 0, calls for pairwise comparisons
# $altP.adjusted
# [1] 0.015456411 0.001003215 1.000000000; differences found

lsas_sum.pre.fu.kw.harmed <- dunn.test(list(
  clinsigraw("lsas_sum", "lower", xT1, xT4, xG3)$harmed,
  clinsigraw("lsas_sum", "lower", xT1, xT4, xG1)$harmed,
  clinsigraw("lsas_sum", "lower", xT1, xT4, xG2)$harmed
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 2.0156, df = 2, p-value = 0.37

lsas_sum.pre.fu.kw.worsened <- dunn.test(list(
  clinsigraw("lsas_sum", "lower", xT1, xT4, xG3)$worsened,
  clinsigraw("lsas_sum", "lower", xT1, xT4, xG1)$worsened,
  clinsigraw("lsas_sum", "lower", xT1, xT4, xG2)$worsened
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 8.4085, df = 2, p-value = 0.01, calls for pairwise comparisons
# $altP.adjusted
# [1] 0.03836684 0.03371498 1.00000000; differences found

well.pre.fu.kw <- dunn.test(list(
  clinsigraw("well", "higher", xT1, xT4, xG3)$recovered,
  clinsigraw("well", "higher", xT1, xT4, xG1)$recovered,
  clinsigraw("well", "higher", xT1, xT4, xG2)$recovered
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 4.7252, df = 2, p-value = 0.09

well.pre.fu.kw.harmed <- dunn.test(list(
  clinsigraw("well", "higher", xT1, xT4, xG3)$harmed,
  clinsigraw("well", "higher", xT1, xT4, xG1)$harmed,
  clinsigraw("well", "higher", xT1, xT4, xG2)$harmed
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 7.3482, df = 2, p-value = 0.03
# $altP.adjusted
# [1] 0.24182013 0.02279335 1.00000000

well.pre.fu.kw.worsened <- dunn.test(list(
  clinsigraw("well", "higher", xT1, xT4, xG3)$worsened,
  clinsigraw("well", "higher", xT1, xT4, xG1)$worsened,
  clinsigraw("well", "higher", xT1, xT4, xG2)$worsened
), method="bonferroni", altp=TRUE)
# Kruskal-Wallis chi-squared = 4.9377, df = 2, p-value = 0.08

```

```{r buildclinsigtab, echo = F, eval = T}

# Clinical significant change table output
clinsig <- function(measure, direction, first, last, group, kwobj) {
  groupkey <- grepl(group, r2fu.itt.data$group)
  kwstars <-
    if (group == xG1) {
      xpss(kwobj$altP.adjusted[1])
    } else if (group == xG2) {
      xpss(kwobj$altP.adjusted[2])
    } else { NULL }
  clinsig <- clinical_significance(
    data = r2fu.itt.data[groupkey, ],
    better_is = direction,
    id = subject,
    time = time,
    outcome = measure,
    pre = first,
    post = last,
    reliability = norms[which(measurementshortnames == measure), 1],
    m_functional = norms[which(measurementshortnames == measure), 2],
    sd_functional = norms[which(measurementshortnames == measure), 3],
    type = "c"
  )
  output <- as.matrix(clinsig$summary[c(2:3)])
    output <-
    paste0(
      "\\parbox[b]{3.12em}{\\flushright$",
      output[, 1],
      "$} ($",
      round(output[, 2] * 100),
      "$\\%)"
    )
  output <- c(paste0(output[1],kwstars), output[c(2:5)])
  return(output)
}

clinsigtext <- function(measure, direction, first, last, group, kwobj, stats = "none") {
  groupkey <- grepl(group, r2fu.itt.data$group)
  row <-
    if (group == xG1) { 1 } else if (group == xG2) { 2 } else { NULL }
  df <- length(kwobj$Z) -1
  kwstars <- paste0(
    "$Z$(",
    df,
    ") = ",
    xresult(kwobj$Z[row],2),
    ", ",
    xpr(kwobj$altP.adjusted[row],a="Bonf")
  ) 
  clinsig <- clinical_significance(
    data = r2fu.itt.data[groupkey, ],
    better_is = direction,
    id = subject,
    time = time,
    outcome = measure,
    pre = first,
    post = last,
    reliability = norms[which(measurementshortnames == measure), 1],
    m_functional = norms[which(measurementshortnames == measure), 2],
    sd_functional = norms[which(measurementshortnames == measure), 3],
    type = "c"
  )
  output <- as.matrix(clinsig$summary[c(2:3)])
  output <-
    paste0(
      # "$n$ = $",
      "$",
      output[, 1],
      "$ participants ($",
      round(output[, 2] * 100),
      "$\\%)"
    )
  if (stats == "sig") {
    output <- c(paste0(output[1], ", ", kwstars), output[c(2:5)])
  } else {
    output <- output[c(1:5)]
  }
  return(output)
}
  
xclinsigcategories <- c("Recovered", "Improved", "Unchanged", "Deteriorated", "Harmed")

  # cbind(
  #   xclinsigcategories,
  #   clinsig("aaas_ag", "higher", xT1, xT3, xG3, aaas_ag.pre.post.kw),
  #   clinsig("aaas_ag", "higher", xT1, xT3, xG1, aaas_ag.pre.post.kw),
  #   clinsig("aaas_ag", "higher", xT1, xT4, xG1, aaas_ag.pre.fu.kw),
  #   clinsig("aaas_ag", "higher", xT1, xT3, xG2, aaas_ag.pre.post.kw),
  #   clinsig("aaas_ag", "higher", xT1, xT4, xG2, aaas_ag.pre.fu.kw)
  # ),

clinsig.table <- rbind(
  cbind(
    xclinsigcategories,
    clinsig("aaas_ad", "higher", xT1, xT3, xG3, aaas_ad.pre.post.kw),
    clinsig("aaas_ad", "higher", xT1, xT3, xG1, aaas_ad.pre.post.kw),
    clinsig("aaas_ad", "higher", xT1, xT4, xG1, aaas_ad.pre.fu.kw),
    clinsig("aaas_ad", "higher", xT1, xT3, xG2, aaas_ad.pre.post.kw),
    clinsig("aaas_ad", "higher", xT1, xT4, xG2, aaas_ad.pre.fu.kw)
  ),
  cbind(
    xclinsigcategories,
    clinsig("aaas_ag", "lower", xT1, xT3, xG3, aaas_ag.pre.post.kw),
    clinsig("aaas_ag", "lower", xT1, xT3, xG1, aaas_ag.pre.post.kw),
    clinsig("aaas_ag", "lower", xT1, xT4, xG1, aaas_ag.pre.fu.kw),
    clinsig("aaas_ag", "lower", xT1, xT3, xG2, aaas_ag.pre.post.kw),
    clinsig("aaas_ag", "lower", xT1, xT4, xG2, aaas_ag.pre.fu.kw)
  ),
  cbind(
    xclinsigcategories,
    clinsig("rathus", "higher", xT1, xT3, xG3, rathus.pre.post.kw),
    clinsig("rathus", "higher", xT1, xT3, xG1, rathus.pre.post.kw),
    clinsig("rathus", "higher", xT1, xT4, xG1, rathus.pre.fu.kw),
    clinsig("rathus", "higher", xT1, xT3, xG2, rathus.pre.post.kw),
    clinsig("rathus", "higher", xT1, xT4, xG2, rathus.pre.fu.kw)
  ),
  cbind(
    xclinsigcategories,
    clinsig("phq_sum", "lower", xT1, xT3, xG3, phq_sum.pre.post.kw),
    clinsig("phq_sum", "lower", xT1, xT3, xG1, phq_sum.pre.post.kw),
    clinsig("phq_sum", "lower", xT1, xT4, xG1, phq_sum.pre.fu.kw),
    clinsig("phq_sum", "lower", xT1, xT3, xG2, phq_sum.pre.post.kw),
    clinsig("phq_sum", "lower", xT1, xT4, xG2, phq_sum.pre.fu.kw)
  ),
  cbind(
    xclinsigcategories,
    clinsig("gad_sum", "lower", xT1, xT3, xG3, gad_sum.pre.post.kw),
    clinsig("gad_sum", "lower", xT1, xT3, xG1, gad_sum.pre.post.kw),
    clinsig("gad_sum", "lower", xT1, xT4, xG1, gad_sum.pre.fu.kw),
    clinsig("gad_sum", "lower", xT1, xT3, xG2, gad_sum.pre.post.kw),
    clinsig("gad_sum", "lower", xT1, xT4, xG2, gad_sum.pre.fu.kw)
  ),
  cbind(
    xclinsigcategories,
    clinsig("lsas_sum", "lower", xT1, xT3, xG3, lsas_sum.pre.post.kw),
    clinsig("lsas_sum", "lower", xT1, xT3, xG1, lsas_sum.pre.post.kw),
    clinsig("lsas_sum", "lower", xT1, xT4, xG1, lsas_sum.pre.fu.kw),
    clinsig("lsas_sum", "lower", xT1, xT3, xG2, lsas_sum.pre.post.kw),
    clinsig("lsas_sum", "lower", xT1, xT4, xG2, lsas_sum.pre.fu.kw)
  ),
  cbind(
    xclinsigcategories,
    clinsig("well", "higher", xT1, xT3, xG3, well.pre.post.kw),
    clinsig("well", "higher", xT1, xT3, xG1, well.pre.post.kw),
    clinsig("well", "higher", xT1, xT4, xG1, well.pre.fu.kw),
    clinsig("well", "higher", xT1, xT3, xG2, well.pre.post.kw),
    clinsig("well", "higher", xT1, xT4, xG2, well.pre.fu.kw)
  )
)

# xcolnames <-
#   c(
#     " ",
#     paste(xG3, xT3),
#     paste(xG1, xT3),
#     paste(xG1, xT4),
#     paste(xG2, xT3),
#     paste(xG2, xT4)
#   )

# xcolnames <-
#   c(
#     " ",
#     paste0(xT1,"--",xT3),
#     paste0(xT1,"--",xT3),
#     paste0(xT1,"--",xT4),
#     paste0(xT1,"--",xT3),
#     paste0(xT1,"--",xT4)
#   )

xcolnames <-
  c(
    " ",
    paste0("\\parbox{7em}{\\hfil{}",xT1,"--",xT3,"\\hfil{}}"),
    paste0("\\parbox{7em}{\\hfil{}",xT1,"--",xT3,"\\hfil{}}"),
    paste0("\\parbox{7em}{\\hfil{}",xT1,"--",xT4text,"\\hfil{}}"),
    paste0("\\parbox{7em}{\\hfil{}",xT1,"--",xT3,"\\hfil{}}"),
    paste0("\\parbox{7em}{\\hfil{}",xT1,"--",xT4text,"\\hfil{}}")
  )

colnames(clinsig.table) <- xcolnames

```

```{r clinsigtab, echo = F, eval = T, results = 'asis'}

knitr::kable(clinsig.table, caption="Clinical significance summary of the number (and proportion in \\%) of participants that changed reliably and moved from the clinical to the functional population from Pre-treatment to Post- and 1-year Follow-up-time points respectively (rows named 'Recovered'). For missing values (i.e., caused by drop-outs), the last collected value was moved forward to the next measurement time point, in order to respect the intention to treat principle.", booktabs = T, format = "latex", align="rlllll", escape = F) %>%
  kable_styling(full_width = F, font_size = 8) %>%
  pack_rows(paste0(measurementnames[1]), 1, 5, bold = F, escape = F) %>%
  pack_rows(paste0(measurementnames[2]), 6, 10, bold = F, escape = F) %>%
  pack_rows(paste0(measurementnames[3]), 11, 15, bold = F, escape = F) %>%
  pack_rows(paste0(measurementnames[4]), 16, 20, bold = F, escape = F) %>%
  pack_rows(paste0(measurementnames[5]), 21, 25, bold = F, escape = F) %>%
  pack_rows(paste0(measurementnames[6]), 26, 30, bold = F, escape = F) %>%
  pack_rows(paste0(measurementnames[7]), 31, 35, bold = F, escape = F) %>%
  row_spec(c(5,10,15,20,25,30), extra_latex_after = "\\midrule") %>%
  column_spec(c(1), width = "7em") %>%
  column_spec(c(2:6), width = "7em") %>%
  add_header_above(c(" ", "Wait-list" = 1, "Unguided self-help" = 2, "Guided self-help" = 2)) %>%
  footnote(
    general = c(
      "AAA-S Adaptive = Adaptive and Aggressive Assertiveness Scales, Adaptive subscale; AAA-S Aggressive = Adaptive and Aggressive Assertiveness Scales, Aggressive Subscale, RAS = Rathus Assertiveness Schedule; PHQ-9 = Patient Health Questionnaire, 9 items; GAD-7 = Generalised Anxiety Disorder 7-item Scale; LSAS-SR = Liebowitz Social Anxiety Scale; Well-being = Questionnaire on Well-being.",
      "\\\\textsuperscript{*} = \\\\textit{p} < .05, \\\\textsuperscript{**} = \\\\textit{p} < .01, \\\\textsuperscript{***} = \\\\textit{p} < .00; \\\\textit{p}-values are Bonferroni adjusted."
      ),
    escape = F,
    general_title = "Notes.",
    footnote_as_chunk = F,
    threeparttable = T
  )

```

# Results

## Treatment efficacy, primary, and secondary measures

Mixed models that included the unguided self-help, guided self-help, and wait-list groups at the pre, during, and post time points revealed time–group interaction effects for all three measures of assertiveness: the AAA-S Adaptive subscale, `r report.anova(aaas_ad.post.anova)[3]`, the AAA-S Aggressive subscale, `r report.anova(aaas_ag.post.anova)[3]`, and the RAS, `r report.anova(rathus.post.anova)[3]`; see Figure 1. These interactions showed that the random assignment to group conditions had an effect over time on assertive behavior. Similarly, mixed models for the syndromal symptoms revealed time–group interaction effects for all four measures of anxiety, depression, and well-being: the PHQ-9, `r report.anova(phq_sum.post.anova)[3]`, the GAD-7, `r report.anova(gad_sum.post.anova)[3]`, the LSAS-SR, `r report.anova(lsas_sum.post.anova)[3]`, and the Well-being questionnaire, `r report.anova(well.post.anova)[3]`; see Figure 2. The estimated mean levels of depressive mood, generalized and social anxiety, and general well-being were significantly affected by participation in the intervention.

All subsequent post-hoc testing of marginal mean differences in pairwise comparisons included all groups and time points.

### Between-group effects on assertive behavior

Post-hoc testing revealed significant effects between both treatment groups and the wait-list group for all three primary measures of assertiveness at the post time point, that is, at the end of the eight-week Respekt^2^ treatment program. It also revealed significant effects at the follow-up one year after the end of treatment compared to the wait-list condition at the post time point. Table 2 summarizes the significance tests of the estimated marginal mean differences and effect sizes, with 95\% confidence intervals (CI).

```{r displaytoggle}

stats <- factor(c("sigshort","sig","delta","effshort","eff","sigeffshort","allshort","all"))

display = stats[7]

```

Compared to the wait-list condition, the effect of the unguided self-help condition on adaptive assertiveness using the AAA-S Adaptive subscale primary measure was large at the post time point, `r report.text2(aaas_ad.out, paste(xT3,xG3,"-",xT3,xG1), -1, display)`, and even larger at the follow-up, `r report.text2(aaas_ad.out, paste(xT3,xG3,"-",xT4,xG1), -1, display)`. Large effects at the post time point were also found for aggressive assertiveness as measured with the AAA-S Aggressive subscale, `r report.text2(aaas_ag.out, paste(xT3,xG3,"-",xT3,xG1), -1, display)`, and at the follow-up, `r report.text2(aaas_ag.out, paste(xT3,xG3,"-",xT4,xG1), -1, display)`. Large effects were also found for “compound” assertiveness assessed with the RAS, `r report.text2(rathus.out, paste(xT3,xG3,"-",xT3,xG1), -1, display)`, and at the follow-up, `r report.text2(rathus.out, paste(xT3,xG3,"-",xT4,xG1), -1, display)`.

Similarly, the effect of the guided self-help condition on the AAA-S Adaptive subscale was large at the post time point, `r report.text2(aaas_ad.out, paste(xT3,xG3,"-",xT3,xG2), -1, display)`, reaching `r report.text2(aaas_ad.out, paste(xT3,xG3,"-",xT4,xG2), -1, display)` at the follow-up. Large effects at the post time point were also identified for the AAA-S Aggressive subscale, `r report.text2(aaas_ag.out, paste(xT3,xG3,"-",xT3,xG2), -1, display)`, and at the follow-up, `r report.text2(aaas_ag.out, paste(xT3,xG3,"-",xT4,xG2), -1, display)`, as well as for the RAS, `r report.text2(rathus.out, paste(xT3,xG3,"-",xT3,xG2), -1, display)` at the post time point, and `r report.text2(rathus.out, paste(xT3,xG3,"-",xT4,xG2), -1, display)` at the follow-up.

Comparing the unguided self-help and guided self-help conditions, no significant differences were found either at the post or the follow-up time points, revealing that the participants working through the intervention on their own fared as well as those who were supported by a therapist.

### Between-group effects on syndromal symptoms of anxiety, depression, and well-being

In the post-hoc testing, no effect on depressive symptoms, measured with the PHQ-9, was found at the post time point comparing the wait-list and the unguided self-help groups. Tentative evidence was found for therapist support benefiting depressed participants: The wait-list versus the guided self-help comparison revealed a moderate to large effect on PHQ-9 at the post time point, `r report.text2(phq_sum.out, paste(xT3,xG3,"-",xT3,xG2), 1, display)`. However, this effect dissipated when the follow-up comparison was instead made against the most conservative value collected in the wait-list group, in this case from the pre time point; see Figure 3 for a visual exploration of a possible nocebo effect.

No between-group effects were found for the GAD-7 when comparing the treatment and the wait-list groups. In addition, there was no significant effect of the unguided self-help condition on social anxiety symptoms measured with the LSAS-SR at the post time point. However, a large effect was found at the follow-up, `r report.text2(lsas_sum.out, paste(xT2,xG3,"-",xT4,xG1), 1, display)` for the unguided self-help group, compared with the lowest value collected at the during time point. For the guided self-help group, a moderate effect was found at the post time point, `r report.text2(lsas_sum.out, paste(xT3,xG3,"-",xT3,xG2), 1, display)`, with a large effect at the follow-up, `r report.text2(lsas_sum.out, paste(xT2,xG3,"-",xT4,xG2), 1, display)`, this time compared with the most conservative value, from the during time point, for the wait-list group.

For general well-being, moderate effects were found at post in both the unguided and the guided groups, 
`r report.text2(well.out, paste(xT3,xG3,"-",xT3,xG1), -1, display)`, and
`r report.text2(well.out, paste(xT3,xG3,"-",xT3,xG2), -1, display)`, respectively, increasing to large effects at follow-up in both treatment groups,
`r report.text2(well.out, paste(xT1,xG3,"-",xT4,xG1), -1, display)`, and
`r report.text2(well.out, paste(xT1,xG3,"-",xT4,xG2), -1, display)`, respectively.

Thus, the eight-week Respekt^2^ intervention did not affect either depression or generalized anxiety. However, it did have a pronounced effect on social anxiety, and on general well-being. See Table 2 for a summary of the significant effects, including 95\% CIs.

### Within-group effects

As shown in Table 2, the participants in both treatment groups enjoyed sustained within-group effects on assertiveness at the follow-up compared to the pre-treatment time point, measured with the AAA-S Adaptive and Aggressive subscales and the RAS. Thus, assertive behavior was still manifested well beyond the end of participation in the intervention. However, significant effects between the post and the follow-up time points were found only for two measures in the guided self-help group, where the AAA-S Adaptive subscale and the RAS exhibited small to moderate effects, `r report.text2(aaas_ad.out, paste(xT3,xG2,"-",xT4,xG2), -1)` and `r report.text2(rathus.out, paste(xT3,xG2,"-",xT4,xG2), -1)`, respectively. In the unguided self-help group, no difference between the post and the follow-up time points was found for either measure, `r xprnot(aaas_ad.out$emmpairs$p.value[41],0)` and `r xprnot(rathus.out$emmpairs$p.value[41])`, indicating that the therapist support provided some benefit to the participants’ ability to generalize adaptive assertive behaviors beyond the duration of the intervention.

Among the secondary measures of syndromal symptoms, depression, as captured with the PHQ-9, decreased significantly from the pre time point only in the guided self-help group and only at the follow-up, showing a medium effect, `r report.text2(phq_sum.out, paste(xT1,xG2,"-",xT4,xG2), 1)`, implying that therapist support benefited depressed participants on a longer rather than a shorter time scale.

### Clinical significant change

#### Reliable recovery with regard to assertive behavior

Adding to the picture that assertive behavior increased as a consequence of participation in the intervention, a significant difference between the groups at the post time point was found in the proportion of participants who had recovered clinically (i.e., had moved across the cutoff for reliable and clinically significant change), with respect to the AAA-S Adaptive subscale, `r report.kw(aaas_ad.pre.post.kw)`, and the RAS, `r report.kw(rathus.pre.post.kw)`. At the follow-up, the proportions of the recovered category were also significantly different for the AAA-S Adaptive subscale,  `r report.kw(aaas_ad.pre.fu.kw)` and for the RAS, `r report.kw(rathus.pre.fu.kw)`. However, no differences in the proportions of recovered participants with regard to the AAA-S Aggressive subscale were found at either time point.

Notably, `r clinsigtext("aaas_ad", "higher", xT1, xT3, xG1, aaas_ad.pre.post.kw)[1]` in the unguided self-help group experienced clinical recovery with regard to adaptive assertiveness measured with the AAA-S Adaptive subscale at the post time point, increasing to `r clinsigtext("aaas_ad", "higher", xT1, xT4, xG1, aaas_ad.pre.fu.kw)[1]` at the follow-up. In the guided self-help group, the number of participants recovered at the post time point was not significantly different from that of the wait-list group, while it was significantly larger at the follow-up, with `r clinsigtext("aaas_ad", "higher", xT1, xT4, xG2, aaas_ad.pre.fu.kw)[1]`. For assertiveness assessed with the RAS, the corresponding numbers (and percentages) were `r clinsigtext("rathus", "higher", xT1, xT3, xG1, rathus.pre.post.kw)[1]` for the unguided self-help condition and `r clinsigtext("rathus", "higher", xT1, xT3, xG2, rathus.pre.post.kw)[1]` for the guided self-help condition at the post time point, increasing to `r clinsigtext("rathus", "higher", xT1, xT4, xG1, rathus.pre.fu.kw)[1]` and `r clinsigtext("rathus", "higher", xT1, xT4, xG2, rathus.pre.fu.kw)[1]`, respectively, at the follow-up.

Thus, the clinical significance findings are mostly in agreement with the statistical analysis of the change, confirming that adaptive expressions of assertiveness in both treatment groups increased from the pre to the post time points and beyond, while deviating with regard to aggressive expressions.

#### Reliable recovery with regard to syndromal symptoms

As for the syndromal symptoms, the proportions of those with reliable recovery from social phobia, as captured with the LSAS-SR, were significantly different between the groups at the post time point, `r report.kw(lsas_sum.pre.post.kw)`. However, no difference between the groups was found at the post time point with regard to the PHQ-9 or GAD-7. At the follow-up, the difference in the proportions of recovered participants between the conditions was significant for the PHQ-9, `r report.kw(phq_sum.pre.fu.kw)`, and the LSAS-SR, `r report.kw(lsas_sum.pre.fu.kw)`, but not for the GAD-7.

Clinical recovery measured with the PHQ-9 between the pre and post time points indicated that the intervention compared to the wait-list condition was effective in taking `r clinsigtext("phq_sum", "lower", xT1, xT3, xG2, phq_sum.pre.post.kw)[1]` out of depression in the guided self-help group, but none in the unguided self-help group, suggesting that interaction with a therapist may aid recovery in depressed participants. In addition, a significant number of participants in the unguided self-help group recovered from social anxiety, as captured with the LSAS-SR, `r clinsigtext("lsas_sum", "lower", xT1, xT3, xG1, lsas_sum.pre.post.kw)[1]`, at the post time point, increasing to `r clinsigtext("lsas_sum", "lower", xT1, xT4, xG1, lsas_sum.pre.fu.kw)[1]` at the follow-up. In the guided self-help condition, no significant number of participants was found to have recovered from social anxiety at the post time point, however, `r clinsigtext("lsas_sum", "lower", xT1, xT4, xG2, lsas_sum.pre.fu.kw)[1]` were found to have recovered at the follow-up. In other words, although there was not immediate effect on social anxiety, symptoms did subside in the year following treatment to the point that a meaningful number of participants had recovered. Combined with the clinically relevant recovery to functional levels of assertive behavior measured with the AAA-S Adaptive subscale and the RAS, this could be a sign of generalization of assertive behavior having continued after the end of treatment, facilitating extinction of autonomous anxiety responses and/or reducing avoidance and escape behaviors from them.

As for general well-being, `r clinsigtext("well", "higher", xT1, xT4, xG2, well.pre.fu.kw)[1]` moved into the recovered category in the guided self-help group, but none in the unguided group, again indicating a possible benefit from therapist support.

Table 3 provides a summary of the numbers and proportions of clinical recovery in the different groups and the significance, if any, of the pairwise tests of proportions against those of the wait-list group.

#### Reliable deterioration and harm

Checking for any reliable signs of harm in the most severe of the adverse outcome categories (see Table 3), significant differences between the groups in clinically significant change were found for the Well-being scale. Post-hoc testing revealed that the number of participants having fallen into the "harmed" category ($6$ participants; $9$\%) in the wait-list group, was significantly larger than in the guided group at both the post time-point
<!-- , `r xpr(well.pre.post.kw.harmed$altP.adjusted[2],a="Bonf")`,  -->
and the follow-up time-point.
<!-- , `r xpr(well.pre.fu.kw.harmed$altP.adjusted[2],a="Bonf")`.  -->
No other instances of suspected reliable harm between the pre and the post time points or the pre to the follow-up time points were identified for either measure.

The second to worst category in assessing reliable change is “deteriorated.” To identify any possible cases of reliable deterioration *and* reliable harm, these two categories were collapsed into the conservative ad hoc category “worsened” gathering participants who had moved into either category. Applying the “worsened” portmanteau category, a significant difference between the groups for the LSAS-SR was found, meriting a follow-up pairwise comparison. This revealed that the number of participants (7 participants; $10$\%) in the wait-list condition who had reached either “deteriorated” or “harmed” between pre and post treatment, was significantly larger than the corresponding number in the guided self-help group. The same held true when comparing the pre to the follow-up time points, where these individuals were significantly more than the number of worsened participants in both the unguided and the guided self-help groups. Finally, a difference between the groups was found for the PHQ-9, with the post-hoc testing revealing a difference for the guided self-help group, with $12$ worsened participants ($18$\%). 

In summary, these findings reveal that the non-active wait-list condition brought about adverse clinical change for $9$\% of the participants with regard to general well-being, $10$\% with regard to social anxiety, and $18$\% with regard to depression.

# Discussion

This randomized controlled trial tested the effects of a transdiagnostic internet intervention targeting assertiveness (Respekt^2^). The findings indicate that the treatment led to increased assertive behavior and reduced psychiatric symptoms. Having been largely ignored as a construct in clinical psychology research since the 1990s, 
<!-- despite its rich history as the target in the very first behavioral therapies of the 1950s and its current status as an important goal for exposure in third-wave CBT variants, such as DBT and ACT [@Speed2018a],  -->
our study provides new data on assertiveness as a viable transdiagnostic stand-alone dependent variable in psychological treatment.

The large effects on assertiveness measured with the AAA-S Adaptive subscale are comparable to those found in clinical trials of iCBT interventions for other transdiagnostic behavioral problems. Measurement with the RAS at the follow-up confirms these effects, as does the insignificantly larger effects found for assertiveness measured with the AAA-S Adaptive subscale and the RAS in the guided self-help group. Benchmarking against procrastination [@Rozental2015] and perfectionism [@Rozental2017], these results indicate that the assertiveness construct can be used successfully as a behavior therapy target with various clinical presentations, helping participants to appreciate and report changes in healthy assertion levels in their daily lives.

<!-- Don't repeat results in Discussion section -->
<!-- The large effects on assertiveness measured with the AAA-S Adaptive subscale, comparing the wait-list and the unguided self-help conditions at the follow-up, `r report.text2(aaas_ad.out, paste(xT3,xG3,"-",xT4,xG1), -1,"effshort")`, with $22$\% clinically improved, are comparable to those found in clinical trials of iCBT interventions for other transdiagnostic behavioral problems. Measurement with the RAS at the follow-up -->
<!-- , `r report.text2(rathus.out, paste(xT3,xG3,"-",xT4,xG1), -1,"effshort")`, with $31$\% clinically improved, -->
<!-- confirms these effects, as does the insignificantly larger effects found for assertiveness measured with the AAA-S Adaptive subscale and the RAS in the guided self-help group, with clinical improvement proportions of $26$\% and $36$\%, respectively. Benchmarking against procrastination [$d$ = `r xresult(0.5,2)`--`r xresult(0.69,2)` and $24$--$36$\% clinically improved in an unguided group, and $d$ = `r xresult(0.70,2)`--`r xresult(0.81,2)` and $31$--$40$\% clinically improved in a guided group\; @Rozental2015] and perfectionism [$d$ = `r xresult(0.68,2)`--`r xresult(1.00,2)`, with $45$\% of participants clinically improved in a guided group\; @Rozental2017], these results indicate that the assertiveness construct can be used successfully as a behavior therapy target with various clinical presentations, helping participants to appreciate and report changes in healthy assertion levels in their daily lives. -->

It should be noted that while there were significant negative effects on aggressive assertiveness in both treatment groups, no statistically significant number of clinically worsened participants was found at either the post or the follow-up time points for the AAA-S Aggressive subscale in either group, compared to the wait-list. This should not be surprising, however, since for this particular sample the baseline levels of aggressive assertiveness were very low. Also, the operationalization of aggressive assertiveness is fuzzy and prone to individual differences in interpretation; behavior that one person deems aggressive assertion might be healthy assertion to another. Likewise, what counts as healthy assertion in one specific societal/cultural context might be perceived as normatively aggressive in another [@Mitamura2018]. Therefore, for a particular individual in a particular context, it is probably warranted to track only how the relationship between levels of adaptive and aggressive assertiveness changes over time, taking into account that individual’s idiographic goals in therapy. This topic may well be further explored in future studies. For the purposes of this study, however, the lack of clinical levels of aggressive assertiveness indicates that participation did not lead to possibly adverse effects in relationships.

<!-- 2do: Introduce and also discuss inverse link anxiety/assertiveness, cite Borkovec1994; Craske and Barlow1988;O’Donnell et al.2007? -->

<!-- 2do: Discuss gender diffs in aggressive assertiveness? @Thompson2011 p 10. -->

The effects at the follow-up on social anxiety and depression are in agreement with those for iCBT in general [@Andrews2018], which in turn is about the same as for face-to-face treatment [@Carlbring2018], with the effects on general well-being of rounding out the picture of benefits from participation. However, the current intervention was insufficient for ameliorating generalized anxiety. Possibly, the overall structure of the Respekt^2^ intervention, with its emphasis on cheerleading participants in designing and performing in vivo behavioral experiments early on in treatment and for a limited time, was not adequate for addressing generalized anxiety symptoms where non-commitment to exposure and behavioral rigidity are often important first hurdles to overcome.

<!-- Don't repeat results in Discussion section -->
<!-- The effects at the follow-up on social anxiety symptoms, `r report.text2(lsas_sum.out, paste(xT2,xG3,"-",xT4,xG1), 1,"effshort")` and `r report.text2(lsas_sum.out, paste(xT2,xG3,"-",xT4,xG2), 1,"effshort")`, and depression, `r report.text2(phq_sum.out, paste(xT2,xG3,"-",xT4,xG1), 1,"effshort")` and `r report.text2(phq_sum.out, paste(xT2,xG3,"-",xT4,xG2), 1,"effshort")`, are in agreement with those for iCBT in general, where the average between-group effect size is $g$ = `r xresult(0.8,2)` compared to controls [@Andrews2018], which in turn is about the same as for face-to-face treatment [@Carlbring2018], with the effects on general well-being of `r report.text2(well.out, paste(xT3,xG3,"-",xT4,xG1), -1,"effshort")` and `r report.text2(well.out, paste(xT3,xG3,"-",xT4,xG2), -1,"effshort")` rounding out the picture of benefits from participation. However, the current intervention was insufficient for ameliorating generalized anxiety symptoms. Possibly, the overall structure of the Respekt^2^ intervention, with its emphasis on cheerleading participants in designing and performing in vivo behavioral experiments early on in treatment and for a limited time, was not adequate for addressing generalized anxiety symptoms where non-commitment to exposure and behavioral rigidity are often important first hurdles to overcome. -->

## Limitations and future directions

The study has a number of limitations that impair the generalizability of the findings. In studies of iCBT, the recruitment method is one of the most important factors influencing the symptom burden of the sample under investigation [@Lindner2015]. Recruitment for this study was performed via advertising on social media, where the presentation of the ads by revenue-maximizing design was skewed to boost click-throughs by the algorithms employed by the respective ad networks. We achieved distributions with regard to sex ($79$--$91$% female participants), higher education level ($70$--$74$%) and previous participation in therapy ($60$--$62$%) that are higher than expected had the sampling been purely random. Generalization of the findings needs to be made with caution before being confirmed with other samples in future studies.

Another methodological drawback of the current study is that some of the measurement scales were recently translated into Swedish without back translation, somewhat impairing the ability to compare findings with the data for the English-speaking populations where the scales were originally validated. The Swedish adaptations of the RAS and AAA-S scales should be quality controlled with back translation prior to future usage and, if possible, also validated for Swedish clinical and non-clinical populations. For the assessment of general well-being, a more established measure than the Well-being Questionnaire should preferably be used. 

It is also noteworthy that the mean levels of depression in the wait-list control group increased as the participants waited in line to begin treatment; this might be due to a nocebo or reverse placebo effect, where participants’ expectations contribute to their mood worsening [@Furukawa2014], which in turn risks inflating between-group effect sizes. Analysis of reliable change confirmed this hypothesis, revealing that 12 individuals ($18$%) in the wait-list group worsened while waiting for treatment. To cancel out this nocebo effect in the analysis, the most conservative estimated marginal mean from either of the pre, during, or post time points was used for the follow-up comparison (in effect, underestimating rather than overestimating the difference). In any future studies, researchers would be wise to employ an active wait-list condition, such as participation in a discussion forum, to avoid running the risk of artificially inflated effect sizes [@Cuijpers2016].

<!-- https://yury-zablotski.netlify.app/post/mixed-models/#why-do-we-need-it-what-are-the-benefits -->
<!-- https://ourcodingclub.github.io/tutorials/mixed-models/#extra -->
Preferably, any future replication or extended version of the current study should also collect data at no less than four time points, allowing data to be fitted not only using random intercepts (controlling for/capturing initial differences between subjects) but also with random slopes (controlling for/capturing individual trajectories). It might also be necessary to add a third level to the model to control for therapist factors.

Along with the third wave of CBT, transdiagnostic behavioral approach goals have gained ground; that is, those captured with the Valued Living Questionnaire [VLQ\; @Wilson2010], the Acceptance and Action Questionnaire [AAQ-II\; @Fledderus2012;@Lundgren2016], or, more generally, the Process-Based Assessment Tool [PBAT\; @Ciarrochi2022]. Further exploration of how the pursuit of healthy assertion goals might influence these and other similar constructs could illuminate what goals are best suited for different patients (or populations) to find acceptable targets that can help short-circuit verbally expressed defenses head-on and thus increase the likelihood of engagement in new learning in CBT. Rhetorically, who does not want to be better still at respectfully asserting their feelings, wishes, and needs?

In the current study, we found that participation in Respekt^2^ increased assertive expressions, thereby reducing self-assessed social anxiety in a non-clinical sample. The intervention did not have an immediate effect on generalized anxiety, although there was some within-group evidence of beneficial longer-term effects on depression. Overall, the findings demonstrate that assertiveness is a potentially useful target in CBT and iCBT in the treatment of both psychiatric syndromes and non-syndromal problems in daily life, calling for more research on the construct in various applications.

# Author contributions

<!-- https://www.elsevier.com/authors/policies-and-guidelines/credit-author-statement -->

Tobias Hagberg and Patrik Manhem performed Conceptualization, Methodology, Investigation, Data curation and Writing - Original Draft; Tobias Hagberg also Software and Formal Analysis; Martin Oscarsson performed Writing - Original Draft; Per Carlbring performed Supervision, Writing - Review & Editing; Fiona Michel and Gerhard Andersson both provided Resources and performed Writing - Review & Editing.

# ORCID

- Tobias Hagberg, \url{https://orcid.org/0000-0001-6059-6668}
- Patrik Manhem, \url{https://orcid.org/0000-0002-2883-9751}
- Martin Oscarsson, \url{https://orcid.org/0000-0002-8209-5351}
- Gerhard Andersson, \url{https://orcid.org/0000-0003-4753-6745}
- Per Carlbring, \url{https://orcid.org/0000-0002-2172-8813}

<!-- \pagebreak -->

# References {.allowframebreaks}

```{r references, echo = F, eval = T}

knitr::write_bib(packages, "packages.bib")

```

\small
